<?xml version="1.0" encoding="UTF-8"?>

<!--<databaseChangeLog-->
<!--        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"-->
<!--        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"-->
<!--        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-->
<!--        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">-->

<databaseChangeLog
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext
    	    https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd
    		http://www.liquibase.org/xml/ns/dbchangelog
    		http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">


    <!--
    	See http://wiki.openmrs.org/display/docs/Module+liquibase+File for
    	documentation on this file.
s
        See http://www.liquibase.org/manual/home#available_database_refactorings
        for a list of supported elements and attributes
    -->

    <changeSet id="supply2-product-create" author="BOGUI SERGE">
        <preConditions onError="WARN" onFail="MARK_RAN">
            <not>
                <tableExists tableName="supply2_product"/>
            </not>
        </preConditions>
        <createTable tableName="supply2_product">
            <column name="product_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <!--            <column name="code" type="varchar(10)">-->
            <!--                <constraints unique="true" nullable="false"/>-->
            <!--            </column>-->
            <column name="conversion_unit" type="double">
                <constraints nullable="false"/>
            </column>
            <column name="creator" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime"/>
            <column name="voided" type="boolean" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="voided_by" type="int"/>
            <column name="date_voided" type="datetime"/>
            <column name="void_reason" type="varchar(255)" defaultValue="null"/>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="supply2_product_creator"
                                 baseTableName="supply2_product" baseColumnNames="creator"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_changed_by"
                                 baseTableName="supply2_product" baseColumnNames="changed_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_voided_by"
                                 baseTableName="supply2_product" baseColumnNames="voided_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
    </changeSet>

    <changeSet id="supply2-product-unit-create" author="BOGUI SERGE">
        <preConditions onError="WARN" onFail="MARK_RAN">
            <not>
                <tableExists tableName="supply2_product_unit"/>
            </not>
        </preConditions>
        <createTable tableName="supply2_product_unit">
            <column name="product_unit_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="varchar(100)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="description" type="varchar(255)"/>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="supply2-product-name-create" author="BOGUI SERGE">
        <preConditions onError="WARN" onFail="MARK_RAN">
            <not>
                <tableExists tableName="supply2_product_name"/>
            </not>
        </preConditions>
        <createTable tableName="supply2_product_name">
            <column name="product_name_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="product_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="product_name_type" type="varchar(50)">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="varchar(255)"/>
            <column name="product_unit" type="int">
                <constraints/>
            </column>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>

        <addForeignKeyConstraint baseTableName="supply2_product_name" baseColumnNames="product_id"
                                 referencedTableName="supply2_product" referencedColumnNames="product_id"
                                 constraintName="supply2_product_name_product"/>
        <addForeignKeyConstraint baseTableName="supply2_product_name" baseColumnNames="product_unit"
                                 referencedTableName="supply2_product_unit" referencedColumnNames="product_unit_id"
                                 constraintName="supply2_product_name_product_unit"/>
    </changeSet>
    <changeSet id="supply2-product-program-create" author="BOGUI SERGE">
        <preConditions onError="WARN" onFail="MARK_RAN">
            <not>
                <tableExists tableName="supply2_product_program"/>
            </not>
        </preConditions>
        <createTable tableName="supply2_product_program">
            <column name="product_program_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="varchar(255)">
                <constraints unique="true" nullable="false"/>
            </column>
            <column name="description" type="varchar(255)"/>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
    </changeSet>
    <!--    <changeSet id="supply2-product-program-members" author="BOGUI SERGE">-->
    <!--        <preConditions onError="WARN" onFail="MARK_RAN">-->
    <!--            <not>-->
    <!--                <tableExists tableName="supply2_product_program_members"/>-->
    <!--            </not>-->
    <!--        </preConditions>-->
    <!--        <createTable tableName="supply2_product_program_members">-->
    <!--            <column name="program_id" type="int">-->
    <!--                <constraints nullable="false" primaryKey="true"/>-->
    <!--            </column>-->
    <!--            <column name="product_id" type="int">-->
    <!--                <constraints nullable="false" primaryKey="true"/>-->
    <!--            </column>-->
    <!--        </createTable>-->

    <!--        <addForeignKeyConstraint constraintName="supply2_product_product_program_members_program"-->
    <!--                                 baseTableName="supply2_product_program_members" baseColumnNames="program_id"-->
    <!--                                 referencedTableName="supply2_product_program"-->
    <!--                                 referencedColumnNames="product_program_id"/>-->

    <!--        <addForeignKeyConstraint constraintName="supply2_product_product_program_members_product"-->
    <!--                                 baseTableName="supply2_product_program_members" baseColumnNames="product_id"-->
    <!--                                 referencedTableName="supply2_product" referencedColumnNames="product_id"/>-->
    <!--    </changeSet>-->

    <changeSet id="supply2-create-product-code" author="BOGUI SERGE">
        <preConditions>
            <not>
                <tableExists tableName="supply2_product_code"/>
            </not>
        </preConditions>
        <createTable tableName="supply2_product_code">
            <column name="product_code_id" type="integer" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="product_id" type="integer">
                <constraints nullable="false"/>
            </column>
            <column name="program_id" type="integer">
                <constraints nullable="false"/>
            </column>
            <column name="code" type="varchar(10)">
                <constraints nullable="false" unique="true"/>
            </column>

            <column name="creator" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime"/>
            <column name="voided" type="boolean" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="voided_by" type="int"/>
            <column name="date_voided" type="datetime"/>
            <column name="void_reason" type="varchar(255)" defaultValue="null"/>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="supply2_product_code_product"
                                 baseTableName="supply2_product_code" baseColumnNames="product_id"
                                 referencedTableName="supply2_product" referencedColumnNames="product_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_code_product_program"
                                 baseTableName="supply2_product_code" baseColumnNames="program_id"
                                 referencedTableName="supply2_product_program"
                                 referencedColumnNames="product_program_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_code_creator"
                                 baseTableName="supply2_product_code" baseColumnNames="creator"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_code_changed_by"
                                 baseTableName="supply2_product_code" baseColumnNames="changed_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_code_voided_by"
                                 baseTableName="supply2_product_code" baseColumnNames="voided_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
    </changeSet>

    <changeSet id="supply2-product-price-create" author="BOGUI SERGE">
        <preConditions onError="WARN" onFail="MARK_RAN">
            <not>
                <tableExists tableName="supply2_product_price"/>
            </not>
        </preConditions>
        <createTable tableName="supply2_product_price">
            <column name="product_price_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="product_code_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="purchase_price" type="double">
                <constraints nullable="false"/>
            </column>
            <column name="sale_price" type="double">
                <constraints nullable="false"/>
            </column>
            <column name="is_active" type="boolean" defaultValueBoolean="true"/>
            <column name="location_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="creator" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime"/>
            <column name="voided" type="boolean" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="voided_by" type="int"/>
            <column name="date_voided" type="datetime"/>
            <column name="void_reason" type="varchar(255)" defaultValue="null"/>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="supply2_product_price_creator"
                                 baseTableName="supply2_product_price" baseColumnNames="creator"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_price_changed_by"
                                 baseTableName="supply2_product_price" baseColumnNames="changed_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_price_voided_by"
                                 baseTableName="supply2_product_price" baseColumnNames="voided_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint baseTableName="supply2_product_price" baseColumnNames="product_code_id"
                                 referencedTableName="supply2_product_code"
                                 referencedColumnNames="product_code_id"
                                 constraintName="supply2_price_product_product_code"/>
        <addForeignKeyConstraint baseTableName="supply2_product_price" baseColumnNames="location_id"
                                 referencedTableName="location" referencedColumnNames="location_id"
                                 constraintName="supply2_product_price_location"/>
    </changeSet>

    <changeSet id="supply2-product-regime" author="BOGUI SERGE">
        <preConditions onError="WARN" onFail="MARK_RAN">
            <not>
                <tableExists tableName="supply2_product_regime"/>
            </not>
        </preConditions>
        <createTable tableName="supply2_product_regime">
            <column name="product_regime_id" type="int" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="concept_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
        <addForeignKeyConstraint constraintName="supply2_product_product_regime_concept"
                                 baseTableName="supply2_product_regime" baseColumnNames="concept_id"
                                 referencedTableName="concept" referencedColumnNames="concept_id"/>
    </changeSet>
    <changeSet id="supply2-product-code-regime-members" author="BOGUI SERGE">
        <preConditions onError="WARN" onFail="MARK_RAN">
            <not>
                <tableExists tableName="supply2_product_code_regime_members"/>
            </not>
        </preConditions>
        <createTable tableName="supply2_product_code_regime_members">
            <column name="regime_id" type="int">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <!--            <column name="product_id" type="int">-->
            <!--                <constraints nullable="false" primaryKey="true"/>-->
            <!--            </column>-->
            <column name="product_code_id" type="int">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="supply2_product_code_regime_members_regime"
                                 baseTableName="supply2_product_code_regime_members"
                                 baseColumnNames="regime_id"
                                 referencedTableName="supply2_product_regime"
                                 referencedColumnNames="product_regime_id"/>

        <addForeignKeyConstraint constraintName="supply2_product_code_regime_product_code"
                                 baseTableName="supply2_product_code_regime_members"
                                 baseColumnNames="product_code_id"
                                 referencedTableName="supply2_product_code"
                                 referencedColumnNames="product_code_id"/>
    </changeSet>
    <changeSet id="supply2-product-attribute-create" author="BOGUI SERGE">
        <preConditions onError="WARN" onFail="MARK_RAN">
            <not>
                <tableExists tableName="supply2_product_attribute"/>
            </not>
        </preConditions>
        <createTable tableName="supply2_product_attribute">
            <column name="product_attribute_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="product_code_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="batch_number" type="varchar(200)">
                <constraints nullable="false"/>
            </column>
            <column name="location_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="expiry_date" type="date">
                <constraints nullable="false"/>
            </column>
            <column name="creator" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime"/>
            <column name="voided" type="boolean" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="voided_by" type="int"/>
            <column name="date_voided" type="datetime"/>
            <column name="void_reason" type="varchar(255)" defaultValue="null"/>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="supply2_product_attribute_creator"
                                 baseTableName="supply2_product_attribute" baseColumnNames="creator"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_attribute_changed_by"
                                 baseTableName="supply2_product_attribute" baseColumnNames="changed_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_attribute_voided_by"
                                 baseTableName="supply2_product_attribute" baseColumnNames="voided_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint baseTableName="supply2_product_attribute" baseColumnNames="product_code_id"
                                 referencedTableName="supply2_product_code"
                                 referencedColumnNames="product_code_id"
                                 constraintName="supply2_product_attribute_product_program_coded"/>
        <addForeignKeyConstraint baseTableName="supply2_product_attribute" baseColumnNames="location_id"
                                 referencedTableName="location" referencedColumnNames="location_id"
                                 constraintName="supply2_product_attribute_location"/>
    </changeSet>
    <changeSet id="supply2-product-operation-attribute-type-create" author="BOGUI SERGE">
        <preConditions onError="WARN" onFail="MARK_RAN">
            <not>
                <tableExists tableName="supply2_product_operation_attribute_type"/>
            </not>
        </preConditions>
        <createTable tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="varchar(255)"/>
            <column name="format" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="foreign_key" type="int"/>
            <column name="sort_weight" type="double"/>
            <column name="searchable" type="boolean" defaultValueBoolean="false"/>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="supply2-product-operation-type" author="BOGUI SERGE">
        <preConditions onError="WARN" onFail="MARK_RAN">
            <not>
                <tableExists tableName="supply2_product_operation_type"/>
            </not>
        </preConditions>
        <createTable tableName="supply2_product_operation_type">
            <column name="product_operation_type_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="varchar(200)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="default_incidence" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="varchar(255)"/>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="supply2-product-operation-type-attribute-type-create" author="BOGUI SERGE">
        <preConditions onError="WARN" onFail="MARK_RAN">
            <not>
                <tableExists tableName="supply2_product_operation_type_attribute_type"/>
            </not>
        </preConditions>
        <createTable tableName="supply2_product_operation_type_attribute_type">
            <column name="operation_type" type="int">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="attribute_type" type="int">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="supply2_product_operation_type_attribute_type_operation_type"
                                 baseTableName="supply2_product_operation_type_attribute_type"
                                 baseColumnNames="operation_type"
                                 referencedTableName="supply2_product_operation_type"
                                 referencedColumnNames="product_operation_type_id"/>

        <addForeignKeyConstraint constraintName="supply2_product_operation_type_attribute_type_attribute_type"
                                 baseTableName="supply2_product_operation_type_attribute_type"
                                 baseColumnNames="attribute_type"
                                 referencedTableName="supply2_product_operation_attribute_type"
                                 referencedColumnNames="product_operation_attribute_type_id"/>
    </changeSet>
    <changeSet id="supply2-product-operation-create" author="BOGUI SERGE">
        <preConditions>
            <not>
                <tableExists tableName="supply2_product_operation"/>
            </not>
        </preConditions>
        <createTable tableName="supply2_product_operation">
            <column name="product_operation_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="operation_number" type="varchar(100)"/>
            <column name="program_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="operation_type" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="operation_date" type="date">
                <constraints nullable="false"/>
            </column>
            <column name="operation_status" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="incidence" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="linked_operation" type="int"/>
            <column name="quantity_type" type="int" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
            <column name="observation" type="varchar(255)"/>
            <column name="exchange_location" type="int"/>
            <column name="location_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="creator" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime"/>
            <column name="voided" type="boolean" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="voided_by" type="int"/>
            <column name="date_voided" type="datetime"/>
            <column name="void_reason" type="varchar(255)" defaultValue="null"/>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
        <addForeignKeyConstraint baseTableName="supply2_product_operation" baseColumnNames="operation_type"
                                 referencedTableName="supply2_product_operation_type"
                                 referencedColumnNames="product_operation_type_id"
                                 constraintName="supply2_product_operation_operation_type"/>

        <addForeignKeyConstraint baseTableName="supply2_product_operation" baseColumnNames="linked_operation"
                                 referencedTableName="supply2_product_operation"
                                 referencedColumnNames="product_operation_id"
                                 constraintName="supply2_product_operation_linked_operation"/>

        <addForeignKeyConstraint baseTableName="supply2_product_operation" baseColumnNames="program_id"
                                 referencedTableName="supply2_product_program"
                                 referencedColumnNames="product_program_id"
                                 constraintName="supply2_product_operation_product_program"/>

        <addForeignKeyConstraint baseTableName="supply2_product_operation" baseColumnNames="location_id"
                                 referencedTableName="location" referencedColumnNames="location_id"
                                 constraintName="supply2_product_operation_location"/>

        <addForeignKeyConstraint baseTableName="supply2_product_operation" baseColumnNames="exchange_location"
                                 referencedTableName="location" referencedColumnNames="location_id"
                                 constraintName="supply2_product_operation_exchange_location"/>

        <addForeignKeyConstraint constraintName="supply2_product_operation_creator"
                                 baseTableName="supply2_product_operation" baseColumnNames="creator"
                                 referencedTableName="users" referencedColumnNames="user_id"/>

        <addForeignKeyConstraint constraintName="supply2_product_operation_changed_by"
                                 baseTableName="supply2_product_operation" baseColumnNames="changed_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>

        <addForeignKeyConstraint constraintName="supply2_product_operation_voided_by"
                                 baseTableName="supply2_product_operation" baseColumnNames="voided_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
    </changeSet>

    <changeSet id="supply2-product-dispensation" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="supply2_product_dispensation"/>
            </not>
        </preConditions>
        <createTable tableName="supply2_product_dispensation">
            <column name="product_operation_id" type="int">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="regime_id" type="int"/>
            <column name="regime_line" type="int"/>
            <column name="age" type="int"/>
            <column name="gender" type="varchar(2)"/>
            <column name="prescription_date" type="date"/>
            <column name="treatment_end_date" type="date"/>
            <column name="treatment_duration" type="int"/>
            <column name="encounter_id" type="int"/>
            <column name="provider_id" type="int"/>
            <column name="goal" type="varchar(100)"/>
        </createTable>

        <addForeignKeyConstraint constraintName="supply2_product_dispensation_product_operation"
                                 baseTableName="supply2_product_dispensation" baseColumnNames="product_operation_id"
                                 referencedTableName="supply2_product_operation"
                                 referencedColumnNames="product_operation_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_dispensation_product_regime"
                                 baseTableName="supply2_product_dispensation" baseColumnNames="regime_id"
                                 referencedTableName="supply2_product_regime"
                                 referencedColumnNames="product_regime_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_dispensation_provider"
                                 baseTableName="supply2_product_dispensation" baseColumnNames="provider_id"
                                 referencedTableName="provider" referencedColumnNames="provider_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_dispensation_encounter"
                                 baseTableName="supply2_product_dispensation" baseColumnNames="encounter_id"
                                 referencedTableName="encounter" referencedColumnNames="encounter_id"/>
    </changeSet>

    <changeSet id="supply2-product-operation-attribute-create" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="supply2_product_operation_attribute"/>
            </not>
        </preConditions>
        <createTable tableName="supply2_product_operation_attribute">
            <column name="product_operation_attribute_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="operation_attribute_type" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="product_operation" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="value" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="location_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="creator" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime"/>
            <column name="voided" type="boolean" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="voided_by" type="int"/>
            <column name="date_voided" type="datetime"/>
            <column name="void_reason" type="varchar(255)" defaultValue="null"/>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
        <addForeignKeyConstraint baseTableName="supply2_product_operation_attribute"
                                 baseColumnNames="operation_attribute_type"
                                 referencedTableName="supply2_product_operation_attribute_type"
                                 referencedColumnNames="product_operation_attribute_type_id"
                                 constraintName="supply2_product_operation_attribute_attribute_type"/>

        <addForeignKeyConstraint baseTableName="supply2_product_operation_attribute"
                                 baseColumnNames="product_operation"
                                 referencedTableName="supply2_product_operation"
                                 referencedColumnNames="product_operation_id"
                                 constraintName="supply2_product_operation_attribute_operation"/>

        <addForeignKeyConstraint baseTableName="supply2_product_operation_attribute" baseColumnNames="location_id"
                                 referencedTableName="location" referencedColumnNames="location_id"
                                 constraintName="supply2_product_operation_attribute_location"/>

        <addForeignKeyConstraint constraintName="supply2_product_operation_attribute_creator"
                                 baseTableName="supply2_product_operation_attribute" baseColumnNames="creator"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_operation_attribute_changed_by"
                                 baseTableName="supply2_product_operation_attribute" baseColumnNames="changed_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_operation_attribute_voided_by"
                                 baseTableName="supply2_product_operation_attribute" baseColumnNames="voided_by"
                                 referencedTableName="users" referencedColumnNames="user_id"/>
    </changeSet>

    <changeSet id="supply2-product-operation-flux-create" author="BOGUI SERGE">
        <preConditions>
            <not>
                <tableExists tableName="supply2_product_operation_flux"/>
            </not>
        </preConditions>
        <createTable tableName="supply2_product_operation_flux">
            <column name="product_operation_flux_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>

            <column name="product_code_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="operation_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="quantity" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="related_quantity" type="double"/>
            <column name="related_quantity_label" type="varchar(200)"/>

            <column name="observation" type="varchar(255)"/>
            <column name="location_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint constraintName="supply2_product_attribute_flux_product_operation"
                                 baseTableName="supply2_product_operation_flux" baseColumnNames="operation_id"
                                 referencedTableName="supply2_product_operation"
                                 referencedColumnNames="product_operation_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_attribute_flux_location"
                                 baseTableName="supply2_product_operation_flux" baseColumnNames="location_id"
                                 referencedTableName="location" referencedColumnNames="location_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_attribute_other_flux_product_coded"
                                 baseTableName="supply2_product_operation_flux"
                                 baseColumnNames="product_code_id"
                                 referencedTableName="supply2_product_code"
                                 referencedColumnNames="product_code_id"/>
    </changeSet>

    <changeSet id="supply2-product-operation-flux-attribute-create" author="BOGUI SERGE">
        <preConditions>
            <not>
                <tableExists tableName="supply2_product_operation_flux_attribute"/>
            </not>
        </preConditions>
        <createTable tableName="supply2_product_operation_flux_attribute">
            <column name="product_operation_flux_attribute_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="product_attribute_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="quantity" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="operation_flux_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="location_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
        <addForeignKeyConstraint constraintName="supply2_product_operation_flux_attribute_product_attribute"
                                 baseTableName="supply2_product_operation_flux_attribute"
                                 baseColumnNames="product_attribute_id"
                                 referencedTableName="supply2_product_attribute"
                                 referencedColumnNames="product_attribute_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_operation_flux_product_attribute"
                                 baseTableName="supply2_product_operation_flux_attribute"
                                 baseColumnNames="operation_flux_id"
                                 referencedTableName="supply2_product_operation_flux"
                                 referencedColumnNames="product_operation_flux_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_operation_flux_attribute_location"
                                 baseTableName="supply2_product_operation_flux_attribute" baseColumnNames="location_id"
                                 referencedTableName="location" referencedColumnNames="location_id"/>
    </changeSet>

    <changeSet id="supply2-product-operation-other-flux-create" author="BOGUI SERGE">
        <preConditions>
            <not>
                <tableExists tableName="supply2_product_operation_other_flux"/>
            </not>
        </preConditions>
        <createTable tableName="supply2_product_operation_other_flux">
            <column name="product_operation_other_flux_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="product_code_id" type="int"/>
            <column name="operation_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="label" type="varchar(10)">
                <constraints nullable="false"/>
            </column>
            <column name="quantity" type="double">
                <constraints nullable="false"/>
            </column>
            <column name="location_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
        <addForeignKeyConstraint constraintName="supply2_product_operation_other_flux_product_operation"
                                 baseTableName="supply2_product_operation_other_flux" baseColumnNames="operation_id"
                                 referencedTableName="supply2_product_operation"
                                 referencedColumnNames="product_operation_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_operation_other_flux_location"
                                 baseTableName="supply2_product_operation_other_flux" baseColumnNames="location_id"
                                 referencedTableName="location" referencedColumnNames="location_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_operation_other_flux_product_code"
                                 baseTableName="supply2_product_operation_other_flux" baseColumnNames="product_code_id"
                                 referencedTableName="supply2_product_code" referencedColumnNames="product_code_id"/>
    </changeSet>

    <changeSet id="supply2-update-remove-product-foreign-key-other-flux" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyName="supply2_product_operation_other_flux_product"/>
        </preConditions>
        <dropForeignKeyConstraint baseTableName="supply2_product_operation_other_flux"
                                  constraintName="supply2_product_operation_other_flux_product"/>
        <renameColumn tableName="supply2_product_operation_other_flux" oldColumnName="product_id"
                      newColumnName="product_code_id" columnDataType="int"/>
    </changeSet>
    <changeSet id="supply2-add-link-operation-other-flux-to-product-code" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="supply2_product_operation_other_flux_product_code"/>
            </not>
        </preConditions>

        <addForeignKeyConstraint constraintName="supply2_product_operation_other_flux_product_code"
                                 baseTableName="supply2_product_operation_other_flux" baseColumnNames="product_code_id"
                                 referencedTableName="supply2_product_code" referencedColumnNames="product_code_id"/>
    </changeSet>

    <changeSet id="supply2-product-attribute-stock-create" author="BOGUI SERGE">
        <preConditions>
            <not>
                <tableExists tableName="supply2_product_attribute_stock"/>
            </not>
        </preConditions>
        <createTable tableName="supply2_product_attribute_stock">
            <column name="product_attribute_stock_id" type="int" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="product_attribute" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="operation_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="quantity_in_stock" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="location_id" type="int">
                <constraints nullable="false"/>
            </column>

            <column name="creator" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime"/>
            <column name="voided" type="boolean" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="voided_by" type="int"/>
            <column name="date_voided" type="datetime"/>
            <column name="void_reason" type="varchar(255)" defaultValue="null"/>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>

        <addForeignKeyConstraint constraintName="supply2_product_attribute_stock_product_attribute"
                                 baseTableName="supply2_product_attribute_stock" baseColumnNames="product_attribute"
                                 referencedTableName="supply2_product_attribute"
                                 referencedColumnNames="product_attribute_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_attribute_stock_location"
                                 baseTableName="supply2_product_attribute_stock" baseColumnNames="location_id"
                                 referencedTableName="location" referencedColumnNames="location_id"/>
        <addForeignKeyConstraint baseTableName="supply2_product_attribute_stock" baseColumnNames="operation_id"
                                 referencedTableName="supply2_product_operation"
                                 referencedColumnNames="product_operation_id"
                                 constraintName="supply2_product_attribute_stock_operation"/>
        <addForeignKeyConstraint baseTableName="supply2_product_attribute_stock" baseColumnNames="creator"
                                 referencedTableName="users" referencedColumnNames="user_id"
                                 constraintName="supply2_product_attribute_stock_creator"/>
        <addForeignKeyConstraint baseTableName="supply2_product_attribute_stock" baseColumnNames="changed_by"
                                 referencedTableName="users" referencedColumnNames="user_id"
                                 constraintName="supply2_product_attribute_stock_changed_by"/>
        <addForeignKeyConstraint baseTableName="supply2_product_attribute_stock" baseColumnNames="voided_by"
                                 referencedTableName="users" referencedColumnNames="user_id"
                                 constraintName="supply2_product_attribute_stock_voided_by"/>

    </changeSet>

    <!--    <changeSet id="supply2-product-attribute-stock-add-program" author="BOGUI SERGE">-->
    <!--        <preConditions>-->
    <!--            <not>-->
    <!--                <columnExists tableName="supply2_product_attribute_stock" columnName="program_id"/>-->
    <!--            </not>-->
    <!--        </preConditions>-->
    <!--        <addColumn tableName="supply2_product_attribute_stock">-->
    <!--            <column name="program_id" type="int">-->
    <!--                <constraints nullable="false"/>-->
    <!--            </column>-->
    <!--        </addColumn>-->
    <!--        <addForeignKeyConstraint baseTableName="supply2_product_attribute_stock" baseColumnNames="program_id"-->
    <!--                                 constraintName="supply2_product_attribute_stock_program"-->
    <!--                                 referencedTableName="supply2_product_program"-->
    <!--                                 referencedColumnNames="product_program_id"/>-->
    <!--    </changeSet>-->

    <!--    <changeSet id="supply2-product-operation-flux-add-related-info" author="BOGUI SERGE">-->
    <!--        <addColumn tableName="supply2_product_operation_flux">-->
    <!--            <column name="related_quantity" type="double"/>-->
    <!--            <column name="related_quantity_label" type="varchar(100)"/>-->
    <!--        </addColumn>-->
    <!--    </changeSet>-->

    <changeSet id="supply2-product-operation-type-insert-all" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*)
                                         FROM supply2_product_operation_type
            </sqlCheck>
        </preConditions>
        <insert tableName="supply2_product_operation_type">
            <column name="product_operation_type_id">1</column>
            <column name="name">Inventaire de produit</column>
            <column name="default_incidence">2</column>
            <column name="description">Inventaire de produit</column>
            <column name="uuid">INVENTORYOOOOOOOOOOOOOOOOOOOOOOOOOOOOO</column>
        </insert>
        <insert tableName="supply2_product_operation_type">
            <column name="product_operation_type_id">2</column>
            <column name="name">Rception de produit</column>
            <column name="default_incidence">1</column>
            <column name="description">Rception de produit</column>
            <column name="uuid">RECEPTIONOOOOOOOOOOOOOOOOOOOOOOOOOOOOO</column>
        </insert>
        <insert tableName="supply2_product_operation_type">
            <column name="product_operation_type_id">3</column>
            <column name="name">Retour de Rception de produit</column>
            <column name="default_incidence">0</column>
            <column name="description">Retour de produits apres rception de produit du fournisseur des clients
                directs
            </column>
            <column name="uuid">RECEPTIONRETURNOOOOOOOOOOOOOOOOOOOOOOO</column>
        </insert>
        <insert tableName="supply2_product_operation_type">
            <column name="product_operation_type_id">4</column>
            <column name="name">Retour de produits au fournisseur</column>
            <column name="default_incidence">0</column>
            <column name="description">Retour de produits du fournisseur</column>
            <column name="uuid">PRODUCTRETURNOOOOOOOOOOOOOOOOOOOOOOOOO</column>
        </insert>
        <insert tableName="supply2_product_operation_type">
            <column name="product_operation_type_id">5</column>
            <column name="name">Transfert sortant de produit</column>
            <column name="default_incidence">0</column>
            <column name="description">Transfert de produits entre client directs de la NPSP Cte d'Ivoire</column>
            <column name="uuid">TRANSFEROUTOOOOOOOOOOOOOOOOOOOOOOOOOOO</column>
        </insert>
        <insert tableName="supply2_product_operation_type">
            <column name="product_operation_type_id">6</column>
            <column name="name">Transfert entrant de produit</column>
            <column name="default_incidence">1</column>
            <column name="description">Transfert de produits entre client directs de la NPSP Cte d'Ivoire</column>
            <column name="uuid">TRANSFERINOOOOOOOOOOOOOOOOOOOOOOOOOOOO</column>
        </insert>
        <insert tableName="supply2_product_operation_type">
            <column name="product_operation_type_id">7</column>
            <column name="name">Peremption de produits</column>
            <column name="default_incidence">0</column>
            <column name="description">Pertes et ajustements concernant les produits perims</column>
            <column name="uuid">EXPIRYOUTOOOOOOOOOOOOOOOOOOOOOOOOOOOOO</column>
        </insert>
        <insert tableName="supply2_product_operation_type">
            <column name="product_operation_type_id">8</column>
            <column name="name">Vols de produits</column>
            <column name="default_incidence">0</column>
            <column name="description">Pertes et ajustements concernant les vols de produits</column>
            <column name="uuid">THIEFOUTOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO</column>
        </insert>
        <insert tableName="supply2_product_operation_type">
            <column name="product_operation_type_id">9</column>
            <column name="name">Produits endommags</column>
            <column name="default_incidence">0</column>
            <column name="description">Pertes et ajustements concernant les produits endomags</column>
            <column name="uuid">DESTROYEDOUTOOOOOOOOOOOOOOOOOOOOOOOOOO</column>
        </insert>
        <insert tableName="supply2_product_operation_type">
            <column name="product_operation_type_id">10</column>
            <column name="name">Produits avaris</column>
            <column name="default_incidence">0</column>
            <column name="description">Pertes et ajustements concernant les produits avaris</column>
            <column name="uuid">SPOILEDOUTOOOOOOOOOOOOOOOOOOOOOOOOOOOO</column>
        </insert>
        <insert tableName="supply2_product_operation_type">
            <column name="product_operation_type_id">11</column>
            <column name="name">Autres pertes de produits</column>
            <column name="default_incidence">0</column>
            <column name="description">Pertes et ajustements concernant les autres pertes</column>
            <column name="uuid">OTHEROUTOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO</column>
        </insert>
        <insert tableName="supply2_product_operation_type">
            <column name="product_operation_type_id">12</column>
            <column name="name">Dons de produits des partenaires</column>
            <column name="default_incidence">0</column>
            <column name="description">Pertes et ajustements concernant les dons</column>
            <column name="uuid">DONATIONENTRYOOOOOOOOOOOOOOOOOOOOOOOOO</column>
        </insert>
        <insert tableName="supply2_product_operation_type">
            <column name="product_operation_type_id">13</column>
            <column name="name">Ajustement inventaire positif</column>
            <column name="default_incidence">2</column>
            <column name="description">Ajustement d'inventaire pour les carts positifs d'inventaire</column>
            <column name="uuid">INVENTORYADJUSTPOSITIVEOOOOOOOOOOOOOOO</column>
        </insert>
        <insert tableName="supply2_product_operation_type">
            <column name="product_operation_type_id">14</column>
            <column name="name">Ajustement inventaire ngatif</column>
            <column name="default_incidence">2</column>
            <column name="description">Ajustement d'inventaire pour les carts ngatifs d'inventaire</column>
            <column name="uuid">INVENTORYADJUSTNEGATIVEOOOOOOOOOOOOOOO</column>
        </insert>
        <insert tableName="supply2_product_operation_type">
            <column name="product_operation_type_id">15</column>
            <column name="name">Dispensation de produits</column>
            <column name="default_incidence">0</column>
            <column name="description">Dispensation de produits aux patients ou consommation</column>
            <column name="uuid">DISPENSATIONOOOOOOOOOOOOOOOOOOOOOOOOOO</column>
        </insert>
        <insert tableName="supply2_product_operation_type">
            <column name="product_operation_type_id">16</column>
            <column name="name">Rapports d'activit</column>
            <column name="default_incidence">3</column>
            <column name="description">Rapport mensuels et de consommation des produits</column>
            <column name="uuid">REPORTOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO</column>
        </insert>
        <insert tableName="supply2_product_operation_type">
            <column name="product_operation_type_id">17</column>
            <column name="name">Rapports urgent d'activit</column>
            <column name="default_incidence">3</column>
            <column name="description">Rapport mensuels et de consommation des produits</column>
            <column name="uuid">URGENTREPORTOOOOOOOOOOOOOOOOOOOOOOOOOO</column>
        </insert>
        <insert tableName="supply2_product_operation_type">
            <column name="product_operation_type_id">18</column>
            <column name="name">Distribution</column>
            <column name="default_incidence">0</column>
            <column name="description">Rapport mensuels et de consommation des produits</column>
            <column name="uuid">DISTRIBUTIONOOOOOOOOOOOOOOOOOOOOOOOOOO</column>
        </insert>
    </changeSet>

    <changeSet id="supply2-add-operation-type-product-back-site" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM supply2_product_operation_type
                WHERE uuid = 'PRODUCTRETURNINOOOOOOOOOOOOOOOOOOOOOOO'
            </sqlCheck>
        </preConditions>

        <insert tableName="supply2_product_operation_type">
            <column name="product_operation_type_id">19</column>
            <column name="name">Retour de produits des sites / services</column>
            <column name="default_incidence">1</column>
            <column name="description">Retour de produits des sites / services</column>
            <column name="uuid">PRODUCTRETURNINOOOOOOOOOOOOOOOOOOOOOOO</column>
        </insert>
    </changeSet>

    <changeSet id="supply2-add-operation-type-partial-inventory" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM supply2_product_operation_type
                WHERE uuid = 'INVENTORYPARTIALOOOOOOOOOOOOOOOOOOOOOO'
            </sqlCheck>
        </preConditions>

        <insert tableName="supply2_product_operation_type">
            <column name="product_operation_type_id">20</column>
            <column name="name">Inventaire partiel</column>
            <column name="default_incidence">2</column>
            <column name="description">Inventire partiel de produts</column>
            <column name="uuid">INVENTORYPARTIALOOOOOOOOOOOOOOOOOOOOOO</column>
        </insert>
    </changeSet>

    <changeSet id="supply2-add-operation-attribute-type-insert" author="BOGUI SERGE" dbms="postgresql">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM supply2_product_operation_attribute_type
            </sqlCheck>
        </preConditions>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">1</column>
            <column name="name">Date de prescription</column>
            <column name="description">Date de prescription de la dispensation</column>
            <column name="format">java.util.Date</column>
            <column name="sort_weight">1</column>
            <column name="searchable">true</column>
            <column name="uuid">PRESCRIPTIONDATEAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">2</column>
            <column name="name">Date dbut inventaire</column>
            <column name="description">Date de de dbut de la priode de l'inventaire</column>
            <column name="format">java.util.Date</column>
            <column name="sort_weight">1</column>
            <column name="searchable">true</column>
            <column name="uuid">INVENTORYSTARTDATEAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">3</column>
            <column name="name">Type inventaire</column>
            <column name="description">Type d'inventaire pour savoir s'il est Partiel ou Total</column>
            <column name="format">java.lang.String</column>
            <column name="sort_weight">1</column>
            <column name="searchable">true</column>
            <column name="uuid">INVENTORYTYPEAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">4</column>
            <column name="name">Partenaire</column>
            <column name="description">Partenaire destinataire pour les sorties et les entres de stocks</column>
            <column name="format">java.lang.String</column>
            <column name="sort_weight">1</column>
            <column name="searchable">true</column>
            <column name="uuid">PARTNERAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>

        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">5</column>
            <column name="name">Date traitement du rapport</column>
            <column name="description">Date de traitement du rapport soumis par le site ou le point de prestation de
                service
            </column>
            <column name="format">java.util.Date</column>
            <column name="sort_weight">1</column>
            <column name="searchable">true</column>
            <column name="uuid">REPORTTREATDATEAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>

        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">6</column>
            <column name="name">Encounter dispensation</column>
            <column name="description">Encounter dispensation for local patient</column>
            <column name="format">org.openmrs.Encounter</column>
            <column name="sort_weight">1</column>
            <column name="searchable">true</column>
            <column name="uuid">ENCOUNTERAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">7</column>
            <column name="name">Patient dispensation</column>
            <column name="description">Dispensation patient for external but existing patient</column>
            <column name="format">org.openmrs.Patient</column>
            <column name="sort_weight">1</column>
            <column name="searchable">true</column>
            <column name="uuid">PATIENTAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">8</column>
            <column name="name">Prescripteur</column>
            <column name="description">Prescripteur de la dispensation</column>
            <column name="format">org.openmrs.Provider</column>
            <column name="sort_weight">1</column>
            <column name="searchable">true</column>
            <column name="uuid">PROVIDERAAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">9</column>
            <column name="name">Age</column>
            <column name="description">Age du patient</column>
            <column name="format">java.lang.Integer</column>
            <column name="sort_weight">1</column>
            <column name="searchable">true</column>
            <column name="uuid">PATIENTAGEAAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">10</column>
            <column name="name">Sexe</column>
            <column name="description">Sexe du patient</column>
            <column name="format">java.lang.String</column>
            <column name="sort_weight">1</column>
            <column name="searchable">true</column>
            <column name="uuid">PATIENTGENDERAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">11</column>
            <column name="name">Regime de dispensation</column>
            <column name="description">Regime de la dispensation au patient</column>
            <column name="format">org.openmrs.module.supply.entities.ProductRegimen</column>
            <column name="sort_weight">1</column>
            <column name="searchable">true</column>
            <column name="uuid">REGIMENAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">12</column>
            <column name="name">Ligne de Regime</column>
            <column name="description">Ligne de Regime de la dispensation au patient</column>
            <column name="format">java.lang.Integer</column>
            <column name="sort_weight">1</column>
            <column name="searchable">true</column>
            <column name="uuid">REGIMENLINEAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">13</column>
            <column name="name">Date fin Traitement</column>
            <column name="description">Date de fin de traitement de la dispensation au patient</column>
            <column name="format">java.util.Date</column>
            <column name="sort_weight">1</column>
            <column name="searchable">true</column>
            <column name="uuid">TREATMENTENDDATEAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">14</column>
            <column name="name">But de la dispensation</column>
            <column name="description">But de la dispensation au patient</column>
            <column name="format">org.openmrs.module.supply.enumerations.Goal</column>
            <column name="sort_weight">1</column>
            <column name="searchable">true</column>
            <column name="uuid">GOALAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">15</column>
            <column name="name">Prescripteur dispensation</column>
            <column name="description">Prescripteur de la dispensation au patient</column>
            <column name="format">org.openmrs.Provider</column>
            <column name="sort_weight">1</column>
            <column name="searchable">true</column>
            <column name="uuid">PROVIDERAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
    </changeSet>

    <changeSet id="supply2-add-operation-attribute-treatment-duration" author="BOGUI SERGE" dbms="postgresql">
        <preConditions>
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM supply2_product_operation_attribute_type
                WHERE uuid = 'TREATMENTDURATIONAAAAAAAAAAAAAAAAAAAAA'
            </sqlCheck>
        </preConditions>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">16</column>
            <column name="name">Dure du traitement</column>
            <column name="description">Dure de traitement de la dispensation</column>
            <column name="format">java.lang.Integer</column>
            <column name="sort_weight">1</column>
            <column name="searchable">true</column>
            <column name="uuid">TREATMENTDURATIONAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
    </changeSet>
    <!--    -->

    <changeSet id="supply2-add-operation-attribute-type-insert-mysql" author="BOGUI SERGE" dbms="mariadb,mysql">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM supply2_product_operation_attribute_type
            </sqlCheck>
        </preConditions>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">1</column>
            <column name="name">Date dbut inventaire</column>
            <column name="description">Date de de dbut de la priode de l'inventaire</column>
            <column name="format">java.util.Date</column>
            <column name="sort_weight">1</column>
            <column name="searchable">1</column>
            <!--            <column name="creator">1</column>-->
            <!--            <column name="date_created">2021-11-26 00:00:00</column>-->
            <!--            <column name="retired">false</column>-->
            <column name="uuid">INVENTORYSTARTDATEAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">2</column>
            <column name="name">Type inventaire</column>
            <column name="description">Type d'inventaire pour savoir s'il est Partiel ou Total</column>
            <column name="format">java.lang.String</column>
            <column name="sort_weight">1</column>
            <column name="searchable">1</column>
            <!--            <column name="creator">1</column>-->
            <!--            <column name="date_created">2021-11-26 00:00:00</column>-->
            <!--            <column name="retired">false</column>-->
            <column name="uuid">INVENTORYTYPEAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <!--        <insert tableName="supply2_product_operation_attribute_type">-->
        <!--            <column name="product_operation_attribute_type_id">4</column>-->
        <!--            <column name="name">Partenaire</column>-->
        <!--            <column name="description">Partenaire destinataire pour les sorties et les entres de stocks</column>-->
        <!--            <column name="format">java.lang.String</column>-->
        <!--            <column name="sort_weight">1</column>-->
        <!--            <column name="searchable">1</column>-->
        <!--            &lt;!&ndash;            <column name="creator">1</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="date_created">2021-11-26 00:00:00</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="retired">false</column>&ndash;&gt;-->
        <!--            <column name="uuid">PARTNERAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>-->
        <!--        </insert>-->

        <!--        <insert tableName="supply2_product_operation_attribute_type">-->
        <!--            <column name="product_operation_attribute_type_id">5</column>-->
        <!--            <column name="name">Date traitement du rapport</column>-->
        <!--            <column name="description">Date de traitement du rapport soumis par le site ou le point de prestation de-->
        <!--                service-->
        <!--            </column>-->
        <!--            <column name="format">java.util.Date</column>-->
        <!--            <column name="sort_weight">1</column>-->
        <!--            <column name="searchable">1</column>-->
        <!--            &lt;!&ndash;            <column name="creator">1</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="date_created">2021-11-26 00:00:00</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="retired">false</column>&ndash;&gt;-->
        <!--            <column name="uuid">REPORTTREATDATEAAAAAAAAAAAAAAAAAAAAA</column>-->
        <!--        </insert>-->

        <!--        <insert tableName="supply2_product_operation_attribute_type">-->
        <!--            <column name="product_operation_attribute_type_id">6</column>-->
        <!--            <column name="name">Encounter dispensation</column>-->
        <!--            <column name="description">Encounter dispensation for local patient</column>-->
        <!--            <column name="format">org.openmrs.Encounter</column>-->
        <!--            <column name="sort_weight">1</column>-->
        <!--            <column name="searchable">1</column>-->
        <!--            &lt;!&ndash;            <column name="creator">1</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="date_created">2021-11-26 00:00:00</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="retired">false</column>&ndash;&gt;-->
        <!--            <column name="uuid">ENCOUNTERAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>-->
        <!--        </insert>-->
        <!--        <insert tableName="supply2_product_operation_attribute_type">-->
        <!--            <column name="product_operation_attribute_type_id">7</column>-->
        <!--            <column name="name">Patient dispensation</column>-->
        <!--            <column name="description">Dispensation patient for external but existing patient</column>-->
        <!--            <column name="format">org.openmrs.Patient</column>-->
        <!--            <column name="sort_weight">1</column>-->
        <!--            <column name="searchable">1</column>-->
        <!--            &lt;!&ndash;            <column name="creator">1</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="date_created">2021-11-26 00:00:00</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="retired">false</column>&ndash;&gt;-->
        <!--            <column name="uuid">PATIENTAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>-->
        <!--        </insert>-->
        <!--        <insert tableName="supply2_product_operation_attribute_type">-->
        <!--            <column name="product_operation_attribute_type_id">8</column>-->
        <!--            <column name="name">Prescripteur</column>-->
        <!--            <column name="description">Prescripteur de la dispensation</column>-->
        <!--            <column name="format">org.openmrs.Provider</column>-->
        <!--            <column name="sort_weight">1</column>-->
        <!--            <column name="searchable">1</column>-->
        <!--            &lt;!&ndash;            <column name="creator">1</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="date_created">2021-11-26 00:00:00</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="retired">false</column>&ndash;&gt;-->
        <!--            <column name="uuid">PROVIDERAAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>-->
        <!--        </insert>-->
        <!--        <insert tableName="supply2_product_operation_attribute_type">-->
        <!--            <column name="product_operation_attribute_type_id">9</column>-->
        <!--            <column name="name">Age</column>-->
        <!--            <column name="description">Age du patient</column>-->
        <!--            <column name="format">java.lang.Integer</column>-->
        <!--            <column name="sort_weight">1</column>-->
        <!--            <column name="searchable">1</column>-->
        <!--            &lt;!&ndash;            <column name="creator">1</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="date_created">2021-11-26 00:00:00</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="retired">false</column>&ndash;&gt;-->
        <!--            <column name="uuid">PATIENTAGEAAAAAAAAAAAAAAAAAAAAAAAAAA</column>-->
        <!--        </insert>-->
        <!--        <insert tableName="supply2_product_operation_attribute_type">-->
        <!--            <column name="product_operation_attribute_type_id">10</column>-->
        <!--            <column name="name">Sexe</column>-->
        <!--            <column name="description">Sexe du patient</column>-->
        <!--            <column name="format">java.lang.String</column>-->
        <!--            <column name="sort_weight">1</column>-->
        <!--            <column name="searchable">1</column>-->
        <!--            &lt;!&ndash;            <column name="creator">1</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="date_created">2021-11-26 00:00:00</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="retired">false</column>&ndash;&gt;-->
        <!--            <column name="uuid">PATIENTGENDERAAAAAAAAAAAAAAAAAAAAAAA</column>-->
        <!--        </insert>-->
        <!--        <insert tableName="supply2_product_operation_attribute_type">-->
        <!--            <column name="product_operation_attribute_type_id">11</column>-->
        <!--            <column name="name">Regime de dispensation</column>-->
        <!--            <column name="description">Regime de la dispensation au patient</column>-->
        <!--            <column name="format">org.openmrs.module.supply2.entities.ProductRegimen</column>-->
        <!--            <column name="sort_weight">1</column>-->
        <!--            <column name="searchable">1</column>-->
        <!--            &lt;!&ndash;            <column name="creator">1</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="date_created">2021-11-26 00:00:00</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="retired">false</column>&ndash;&gt;-->
        <!--            <column name="uuid">REGIMENAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>-->
        <!--        </insert>-->
        <!--        <insert tableName="supply2_product_operation_attribute_type">-->
        <!--            <column name="product_operation_attribute_type_id">12</column>-->
        <!--            <column name="name">Ligne de Regime</column>-->
        <!--            <column name="description">Ligne de Regime de la dispensation au patient</column>-->
        <!--            <column name="format">java.lang.Integer</column>-->
        <!--            <column name="sort_weight">1</column>-->
        <!--            <column name="searchable">1</column>-->
        <!--            &lt;!&ndash;            <column name="creator">1</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="date_created">2021-11-26 00:00:00</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="retired">false</column>&ndash;&gt;-->
        <!--            <column name="uuid">REGIMENLINEAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>-->
        <!--        </insert>-->
        <!--        <insert tableName="supply2_product_operation_attribute_type">-->
        <!--            <column name="product_operation_attribute_type_id">13</column>-->
        <!--            <column name="name">Date fin Traitement</column>-->
        <!--            <column name="description">Date de fin de traitement de la dispensation au patient</column>-->
        <!--            <column name="format">java.util.Date</column>-->
        <!--            <column name="sort_weight">1</column>-->
        <!--            <column name="searchable">1</column>-->
        <!--            &lt;!&ndash;            <column name="creator">1</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="date_created">2021-11-26 00:00:00</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="retired">false</column>&ndash;&gt;-->
        <!--            <column name="uuid">TREATMENTENDDATEAAAAAAAAAAAAAAAAAAAAAA</column>-->
        <!--        </insert>-->
        <!--        <insert tableName="supply2_product_operation_attribute_type">-->
        <!--            <column name="product_operation_attribute_type_id">14</column>-->
        <!--            <column name="name">But de la dispensation</column>-->
        <!--            <column name="description">But de la dispensation au patient</column>-->
        <!--            <column name="format">org.openmrs.module.supply2.enumerations.Goal</column>-->
        <!--            <column name="sort_weight">1</column>-->
        <!--            <column name="searchable">1</column>-->
        <!--            &lt;!&ndash;            <column name="creator">1</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="date_created">2021-11-26 00:00:00</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="retired">false</column>&ndash;&gt;-->
        <!--            <column name="uuid">GOALAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>-->
        <!--        </insert>-->
        <!--        <insert tableName="supply2_product_operation_attribute_type">-->
        <!--            <column name="product_operation_attribute_type_id">15</column>-->
        <!--            <column name="name">Prescripteur dispensation</column>-->
        <!--            <column name="description">Prescripteur de la dispensation au patient</column>-->
        <!--            <column name="format">org.openmrs.Provider</column>-->
        <!--            <column name="sort_weight">1</column>-->
        <!--            <column name="searchable">1</column>-->
        <!--            &lt;!&ndash;            <column name="creator">1</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="date_created">2021-11-26 00:00:00</column>&ndash;&gt;-->
        <!--            &lt;!&ndash;            <column name="retired">false</column>&ndash;&gt;-->
        <!--            <column name="uuid">PROVIDERAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>-->
        <!--        </insert>-->
        <!--        <insert tableName="supply2_product_operation_attribute_type">-->
        <!--            <column name="product_operation_attribute_type_id">16</column>-->
        <!--            <column name="name">Dure du traitement</column>-->
        <!--            <column name="description">Dure de traitement de la dispensation</column>-->
        <!--            <column name="format">java.lang.Integer</column>-->
        <!--            <column name="sort_weight">1</column>-->
        <!--            <column name="searchable">1</column>-->
        <!--            <column name="uuid">TREATMENTDURATIONAAAAAAAAAAAAAAAAAAAAA</column>-->
        <!--        </insert>-->
    </changeSet>

    <!--    -->
    <changeSet id="supply2-add-attribute-type-to-operation-type" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <sqlCheck expectedResult="0">SELECT COUNT(*)
                                         FROM supply2_product_operation_type_attribute_type
            </sqlCheck>
        </preConditions>
        <!-- Inventory -->
        <insert tableName="supply2_product_operation_type_attribute_type">
            <column name="operation_type" value="1"/>
            <column name="attribute_type" value="1"/>
        </insert>
        <insert tableName="supply2_product_operation_type_attribute_type">
            <column name="operation_type" value="1"/>
            <column name="attribute_type" value="2"/>
        </insert>
        <!-- /Inventory -->

        <!--        &lt;!&ndash; Donation &ndash;&gt;-->
        <!--        <insert tableName="supply2_product_operation_type_attribute_type">-->
        <!--            <column name="operation_type" value="12"/>-->
        <!--            <column name="attribute_type" value="4"/>-->
        <!--        </insert>-->
        <!--        &lt;!&ndash; /Donation &ndash;&gt;-->

        <!--        &lt;!&ndash; Dispensation &ndash;&gt;-->
        <!--        <insert tableName="supply2_product_operation_type_attribute_type">-->
        <!--            <column name="operation_type" value="15"/>-->
        <!--            <column name="attribute_type" value="1"/>-->
        <!--        </insert>-->
        <!--        <insert tableName="supply2_product_operation_type_attribute_type">-->
        <!--            <column name="operation_type" value="15"/>-->
        <!--            <column name="attribute_type" value="6"/>-->
        <!--        </insert>-->
        <!--        <insert tableName="supply2_product_operation_type_attribute_type">-->
        <!--            <column name="operation_type" value="15"/>-->
        <!--            <column name="attribute_type" value="7"/>-->
        <!--        </insert>-->
        <!--        <insert tableName="supply2_product_operation_type_attribute_type">-->
        <!--            <column name="operation_type" value="15"/>-->
        <!--            <column name="attribute_type" value="8"/>-->
        <!--        </insert>-->
        <!--        <insert tableName="supply2_product_operation_type_attribute_type">-->
        <!--            <column name="operation_type" value="15"/>-->
        <!--            <column name="attribute_type" value="9"/>-->
        <!--        </insert>-->
        <!--        <insert tableName="supply2_product_operation_type_attribute_type">-->
        <!--            <column name="operation_type" value="15"/>-->
        <!--            <column name="attribute_type" value="10"/>-->
        <!--        </insert>-->
        <!--        <insert tableName="supply2_product_operation_type_attribute_type">-->
        <!--            <column name="operation_type" value="15"/>-->
        <!--            <column name="attribute_type" value="11"/>-->
        <!--        </insert>-->
        <!--        <insert tableName="supply2_product_operation_type_attribute_type">-->
        <!--            <column name="operation_type" value="15"/>-->
        <!--            <column name="attribute_type" value="12"/>-->
        <!--        </insert>-->
        <!--        <insert tableName="supply2_product_operation_type_attribute_type">-->
        <!--            <column name="operation_type" value="15"/>-->
        <!--            <column name="attribute_type" value="13"/>-->
        <!--        </insert>-->
        <!--        <insert tableName="supply2_product_operation_type_attribute_type">-->
        <!--            <column name="operation_type" value="15"/>-->
        <!--            <column name="attribute_type" value="14"/>-->
        <!--        </insert>-->
        <!--        <insert tableName="supply2_product_operation_type_attribute_type">-->
        <!--            <column name="operation_type" value="15"/>-->
        <!--            <column name="attribute_type" value="15"/>-->
        <!--        </insert>-->
        <!--        &lt;!&ndash; /Dispensation &ndash;&gt;-->

        <!--        &lt;!&ndash; Distribution &ndash;&gt;-->
        <!--        <insert tableName="supply2_product_operation_type_attribute_type">-->
        <!--            <column name="operation_type" value="18"/>-->
        <!--            <column name="attribute_type" value="5"/>-->
        <!--        </insert>-->
        <!--        &lt;!&ndash; /Report &ndash;&gt;-->
    </changeSet>

    <!--    <changeSet id="supply2-remove-duplicate-answer-concept-165041" author="BOGUI SERGE">-->
    <!--        <preConditions onFail="MARK_RAN">-->
    <!--            <sqlCheck expectedResult="2">SELECT COUNT(*)-->
    <!--                                         FROM concept_answer-->
    <!--                                         WHERE concept_id = 162240-->
    <!--                                           AND answer_concept = 165041 </sqlCheck>-->
    <!--        </preConditions>-->
    <!--        <sql>-->
    <!--            DELETE-->
    <!--            FROM concept_answer-->
    <!--            WHERE concept_answer_id =-->
    <!--                  (SELECT MAX(concept_answer_id)-->
    <!--                   FROM concept_answer-->
    <!--                   WHERE concept_id = 162240-->
    <!--                     AND answer_concept = 165041-->
    <!--                   GROUP BY concept_id)-->
    <!--        </sql>-->
    <!--    </changeSet>-->

    <changeSet id="supply-regime-concept-insert" author="BOGUI SERGE" runAlways="true">
        <sql>
            INSERT INTO supply2_product_regime (concept_id, uuid)
            SELECT answer_concept, c.uuid
            FROM concept_answer ca,
                 concept c
            WHERE c.concept_id = ca.answer_concept
              AND ca.concept_id = 162240
              AND c.concept_id NOT IN (SELECT concept_id FROM supply2_product_regime);
        </sql>
    </changeSet>
    <!--    <changeSet id="supply2-operation-flux-remove-location-unique-key" author="BOGUI SERGE">-->
    <!--        <dropUniqueConstraint tableName="supply2_product_operation_flux"-->
    <!--                              constraintName="supply2_product_operation_flux_location_id_key"/>-->
    <!--    </changeSet>-->

    <changeSet id="supply-add-country-local-supplier" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(location_id)
                                         FROM location
                                         WHERE uuid = 'NPSPLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLL'
            </sqlCheck>
        </preConditions>
        <insert tableName="location">
            <column name="name">NOUVELLE PHARMACIE DE LA SANT PUBLIQUE</column>
            <column name="description">NOUVELLE PHARMACIE DE LA SANT PUBLIQUE CTE D'IVOIRE</column>
            <column name="postal_code">NPSP-CI</column>
            <column name="uuid">NPSPLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLL</column>
            <column name="creator" valueNumeric="1"/>
            <column name="date_created" type="datetime" valueDate="2022-02-01"/>
            <column name="retired" type="boolean" valueBoolean="false"/>
            <column name="parent_location" type="int" valueNumeric="1"/>
        </insert>
    </changeSet>
    <!--    <changeSet id="supply2-remove-unique-key-batch-number" author="BOGUI SERGE">-->
    <!--        <dropUniqueConstraint-->
    <!--                tableName="supply2_product_attribute"-->
    <!--                constraintName="supply2_product_attribute_batch_number_key"-->
    <!--                uniqueColumns="batch_number"/>-->
    <!--    </changeSet>-->


    <changeSet id="location_attribute_is_direct_client-postgresql" author="BOGUI SERGE" dbms="postgresql">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(name)
                FROM location_attribute_type
                WHERE name = 'NPSPCLIENTCCCCCCCCCCCCCCCCCCCCCCCCCC';
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO location_attribute_type
                (name, datatype, min_occurs, creator, date_created, retired, uuid)
            VALUES ('Client Direct NPSP', 'org.openmrs.customdatatype.datatype.BooleanDatatype', 0, 1,
                    '2020-12-15 21:10:08', false, 'NPSPCLIENTCCCCCCCCCCCCCCCCCCCCCCCCCC');

        </sql>
    </changeSet>

    <changeSet id="location_attribute_is_direct_client-mysql-1" author="BOGUI SERGE" dbms="mysql,mariadb">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(name)
                FROM location_attribute_type
                WHERE uuid = 'NPSPCLIENTCCCCCCCCCCCCCCCCCCCCCCCCCC';
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO location_attribute_type
                (name, datatype, min_occurs, creator, date_created, retired, uuid)
            VALUES ('Client Direct NPSP', 'org.openmrs.customdatatype.datatype.BooleanDatatype', 0, 1,
                    '2020-12-15 21:10:08', 0, 'NPSPCLIENTCCCCCCCCCCCCCCCCCCCCCCCCCC');
        </sql>
    </changeSet>

    <changeSet id="supply-create-direct-clients-postgresql" author="BOGUI SERGE" runAlways="true" dbms="postgresql">
        <sql>
            INSERT INTO location_attribute (location_attribute_id, location_id, attribute_type_id, value_reference,
                                            uuid, creator, date_created, voided)
            SELECT NULL   AS                                             location_attribute_id,
                   location_id,
                   (SELECT location_attribute_type_id
                    FROM location_attribute_type
                    WHERE uuid = 'NPSPCLIENTCCCCCCCCCCCCCCCCCCCCCCCCCC') attribute_type_id,
                   'true' AS                                             value_reference,
                   uuid() AS                                             uuid,
                   1,
                   '2021-01-01 00:00:00',
                   false
            FROM location l
            WHERE (name LIKE 'CHU %' OR name LIKE 'CHR %' OR name LIKE 'HG %' OR name LIKE 'DISTRICT SANITAIRE %')
              AND location_id NOT IN (SELECT location_id
                                      FROM location_attribute la
                                      WHERE attribute_type_id = (SELECT location_attribute_type_id
                                                                 FROM location_attribute_type lat
                                                                 WHERE uuid = 'NPSPCLIENTCCCCCCCCCCCCCCCCCCCCCCCCCC')
                                        AND la.location_id = l.location_id)
        </sql>
    </changeSet>

    <changeSet id="supply-create-direct-clients-mysql" author="BOGUI SERGE" runAlways="true" dbms="mysql,mariadb">
        <sql>
            INSERT INTO location_attribute (location_attribute_id, location_id, attribute_type_id, value_reference,
                                            uuid, creator, date_created, voided)
            SELECT NULL   AS                                             location_attribute_id,
                   location_id,
                   (SELECT location_attribute_type_id
                    FROM location_attribute_type
                    WHERE uuid = 'NPSPCLIENTCCCCCCCCCCCCCCCCCCCCCCCCCC') attribute_type_id,
                   'true' AS                                             value_reference,
                   uuid() AS                                             uuid,
                   1,
                   '2021-01-01 00:00:00',
                   0
            FROM location l
            WHERE (name LIKE 'CHU %' OR name LIKE 'CHR %' OR name LIKE 'HG %' OR name LIKE 'DISTRICT SANITAIRE %')
              AND location_id NOT IN (SELECT location_id
                                      FROM location_attribute la
                                      WHERE attribute_type_id = (SELECT location_attribute_type_id
                                                                 FROM location_attribute_type lat
                                                                 WHERE uuid = 'NPSPCLIENTCCCCCCCCCCCCCCCCCCCCCCCCCC')
                                        AND la.location_id = l.location_id)
        </sql>
    </changeSet>

    <changeSet id="location_attribute_program_available-postgresql" author="BOGUI SERGE" dbms="postgresql">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(name)
                FROM location_attribute_type
                WHERE uuid = 'AVAILPRGRMCCCCCCCCCCCCCCCCCCCCCCCCCC';
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO location_attribute_type
                (name, datatype, min_occurs, creator, date_created, retired, uuid)
            VALUES ('Programmes Disponibles', 'org.openmrs.customdatatype.datatype.FreeTextDatatype', 0, 1,
                    '2021-01-01 21:10:08', false, 'AVAILPRGRMCCCCCCCCCCCCCCCCCCCCCCCCCC');
        </sql>
    </changeSet>

    <changeSet id="location_attribute_program_available-mysql" author="BOGUI SERGE" dbms="mysql,mariadb">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM location_attribute_type
                WHERE uuid = 'AVAILPRGRMCCCCCCCCCCCCCCCCCCCCCCCCCC';
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO location_attribute_type
                (name, datatype, min_occurs, creator, date_created, retired, uuid)
            VALUES ('Programmes Disponibles', 'org.openmrs.customdatatype.datatype.FreeTextDatatype', 0, 1,
                    '2021-01-01 21:10:08', 0, 'AVAILPRGRMCCCCCCCCCCCCCCCCCCCCCCCCCC');
        </sql>
    </changeSet>

    <changeSet id="location_attribute_level-postgresql" author="BOGUI SERGE" dbms="postgresql">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM location_attribute_type
                WHERE uuid = 'LEVELCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC';
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO location_attribute_type
                (name, datatype, min_occurs, creator, date_created, retired, uuid)
            VALUES ('Niveau', 'org.openmrs.customdatatype.datatype.FreeTextDatatype', 0, 1, '2021-01-01 21:10:08',
                    false, 'LEVELCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC');
        </sql>
    </changeSet>

    <changeSet id="location_attribute_level-mysql" author="BOGUI SERGE" dbms="mysql,mariadb">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM location_attribute_type
                WHERE uuid = 'LEVELCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC';
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO location_attribute_type
                (name, datatype, min_occurs, creator, date_created, retired, uuid)
            VALUES ('Niveau', 'org.openmrs.customdatatype.datatype.FreeTextDatatype', 0, 1, '2021-01-01 21:10:08', 0,
                    'LEVELCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC');
        </sql>
    </changeSet>

    <changeSet id="location-attribute-npsp-code-postgresql" author="BOGUI SERGE" dbms="postgresql">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM location_attribute_type
                WHERE name = 'CODENPSPCCCCCCCCCCCCCCCCCCCCCCCCCCCC';
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO location_attribute_type
                (name, datatype, min_occurs, creator, date_created, retired, uuid)
            VALUES ('CODE NPSP', 'org.openmrs.customdatatype.datatype.FreeTextDatatype', 0, 1, '2021-02-06 13:00:00',
                    false, 'CODENPSPCCCCCCCCCCCCCCCCCCCCCCCCCCCC');
        </sql>
    </changeSet>

    <changeSet id="location-attribute-npsp-code-mysql" author="BOGUI SERGE" dbms="mysql,mariadb">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM location_attribute_type
                WHERE uuid = 'CODENPSPCCCCCCCCCCCCCCCCCCCCCCCCCCCC';
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO location_attribute_type
                (name, datatype, min_occurs, creator, date_created, retired, uuid)
            VALUES ('CODE NPSP', 'org.openmrs.customdatatype.datatype.FreeTextDatatype', 0, 1, '2021-02-06 13:00:00', 0,
                    'CODENPSPCCCCCCCCCCCCCCCCCCCCCCCCCCCC');
        </sql>
    </changeSet>

    <changeSet id="supply2-add-TDF-3TC-concept-to-regimen-list" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM supply2_product_regime
                WHERE concept_id = 161364;
            </sqlCheck>
        </preConditions>
        <sql>
            <![CDATA[
            INSERT INTO supply2_product_regime (concept_id, uuid)
            VALUES (161364, '161364AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA');
            UPDATE concept_name
            SET name = 'TDF 3TC'
            WHERE concept_id = 161364;
            ]]>
        </sql>
    </changeSet>

    <changeSet id="supply-provider-attribute-location" author="BOGUI SERGE" dbms="mysql,mariadb">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM provider_attribute_type
                WHERE uuid = 'LOCATIONPPPPPPPPPPPPPPPPPPPPPPPPPPPP';
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO provider_attribute_type
                (name, datatype, min_occurs, creator, date_created, retired, uuid)
            VALUES ('Location', 'org.openmrs.customdatatype.datatype.FreeTextDatatype', 0, 1, '2021-02-27 21:10:08', 0,
                    'LOCATIONPPPPPPPPPPPPPPPPPPPPPPPPPPPP');
        </sql>
    </changeSet>

    <changeSet id="supply-provider-attribute-location-postgresql" author="BOGUI SERGE" dbms="postgresql">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM provider_attribute_type
                WHERE uuid = 'LOCATIONPPPPPPPPPPPPPPPPPPPPPPPPPPPP';
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO provider_attribute_type
                (name, datatype, min_occurs, creator, date_created, retired, uuid)
            VALUES ('Location', 'org.openmrs.customdatatype.datatype.FreeTextDatatype', 0, 1, '2021-02-27 21:10:08',
                    false, 'LOCATIONPPPPPPPPPPPPPPPPPPPPPPPPPPPP');
        </sql>
    </changeSet>

    <!--CONCEPTS-->
    <changeSet id="supply-add-goal-postgresql" author="BOGUI SERGE" dbms="postgresql">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(concept_id)
                FROM concept
                WHERE concept_id = 163000
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO concept (concept_id, retired, datatype_id, class_id, is_set, creator, date_created, uuid)
            VALUES (163000, false, 3, 7, 0, 1, '2020-11-27 00:00:00', '163000AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA');

            INSERT INTO concept_name (concept_id, name, date_created, concept_name_type, creator, locale,
                                      locale_preferred, voided, uuid)
            VALUES (163000, 'But', '2020-11-27 00:00:00', 'FULLY_SPECIFIED', 1, 'fr', 1, false,
                    '163000FRAAAAAAAAAAAAAAAAAAAAAAAAAAAA');
            INSERT INTO concept_name (concept_id, name, date_created, concept_name_type, creator, locale,
                                      locale_preferred, voided, uuid)
            VALUES (163000, 'Goal', '2020-11-27 00:00:00', 'FULLY_SPECIFIED', 1, 'en', 0, false,
                    '163000ENAAAAAAAAAAAAAAAAAAAAAAAAAAAA');
        </sql>
    </changeSet>

    <changeSet id="supply-add-goal-mysql" author="BOGUI SERGE" dbms="mariadb, mysql">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(concept_id)
                FROM concept
                WHERE concept_id = 163000
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO concept (concept_id, retired, datatype_id, class_id, is_set, creator, date_created, uuid)
            VALUES (163000, false, 3, 7, 0, 1, '2020-11-27 00:00:00', '163000AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA');

            INSERT INTO concept_name (concept_id, name, date_created, concept_name_type, creator, locale,
                                      locale_preferred, voided, uuid)
            VALUES (163000, 'Goal', '2020-11-27 00:00:00', 'FULLY_SPECIFIED', 1, 'en', true, false,
                    '163000ENAAAAAAAAAAAAAAAAAAAAAAAAAAAA');
            INSERT INTO concept_name (concept_id, name, date_created, concept_name_type, creator, locale,
                                      locale_preferred, voided, uuid)
            VALUES (163000, 'But', '2020-11-27 00:00:00', 'FULLY_SPECIFIED', 1, 'fr', false, false,
                    '163000FRAAAAAAAAAAAAAAAAAAAAAAAAAAAA');
        </sql>
    </changeSet>

    <changeSet id="supply-update-concept-dispensation-uuid" author="BOGUI SERGE" runAlways="true">
        <sql>
            UPDATE concept
            SET uuid = CONCAT(concept_id, 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA')
            WHERE concept_id > 999
              AND uuid LIKE '%-%-%';
        </sql>
    </changeSet>

    <changeSet id="supply2-update-product-regime-uuid" author="BOGUI SERGE" runAlways="true">
        <sql>
            UPDATE supply2_product_regime
            SET uuid = CONCAT(concept_id, 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA')
            WHERE concept_id > 999
              AND uuid LIKE '%-%-%';
        </sql>
    </changeSet>
    <!--/CONCEPTS-->

    <!-- ROLES   -->

    <changeSet id="supply-create-role-auxiliary-2" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(role)
                FROM role
                WHERE role = 'AUXILIAIRE'
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO role (role, description, uuid) VALUE ('AUXILIAIRE', 'Auxiliaire de la pharmacie',
            'AUXILIAIRERRRRRRRRRRRRRRRRRRRRRRRRRR');
        </sql>
    </changeSet>
    <changeSet id="supply-create-role-pgp-2" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(role)
                FROM role
                WHERE role = 'PGP'
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO role (role, description, uuid) VALUE ('PGP', 'Pharmacien de la pharmacie',
            'PGPRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRR');
        </sql>
    </changeSet>

    <changeSet id="supply-create-role-pharmacist-2" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(role)
                FROM role
                WHERE role = 'PHARMACIEN'
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO role (role, description, uuid) VALUE ('PHARMACIEN', 'Pharmacien de la pharmacie',
            'PHARMACIENRRRRRRRRRRRRRRRRRRRRRRRRRR');
        </sql>
    </changeSet>

    <changeSet id="supply-create-role-pgp-auxiliary" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM role_role
                WHERE parent_role = 'AUXILIAIRE'
                  AND child_role = 'PGP'
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO role_role (parent_role, child_role)
            VALUES ('AUXILIAIRE', 'PGP');
        </sql>
    </changeSet>

    <changeSet id="supply-create-role-pgp-pharmacist" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM role_role
                WHERE parent_role = 'PGP'
                  AND child_role = 'PHARMACIEN'
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO role_role (parent_role, child_role)
            VALUES ('PGP', 'PHARMACIEN');
        </sql>
    </changeSet>

    <!-- /ROLES-->

    <changeSet id="add-encounter-type-dispensation" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM encounter_type
                WHERE name = 'DISPENSATION'
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO encounter_type (name, description, creator, date_created, retired, uuid)
                VALUE ('DISPENSATION', NULL, 1, '2020-11-10', 0, 'DISPENSATIONEEEEEEEEEEEEEEEEEEEEEEEE');
        </sql>
    </changeSet>

    <changeSet id="supply-dispensation-encounter-transform-mysql" author="BOGUI SERGE" dbms="mysql, mariadb">
        <sql>
            INSERT INTO encounter (encounter_type, patient_id, location_id, encounter_datetime, creator, date_created,
                                   voided, uuid)
            SELECT (SELECT encounter_type_id FROM encounter_type WHERE name = 'DISPENSATION') AS encounter_type,
                   person_id,
                   location_id,
                   obs_datetime,
                   creator,
                   date_created,
                   voided,
                   uuid()                                                                     AS uuid
            FROM obs
            WHERE concept_id = 165010
              AND encounter_id IS NULL
              AND voided = 0;

            UPDATE
                obs o LEFT JOIN encounter e
            ON e.encounter_datetime = o.obs_datetime AND patient_id = person_id AND o.date_created = e.date_created
                SET o.encounter_id = e.encounter_id
            WHERE o.concept_id IN (164050, 165033, 165040, 165011, 165010) AND o.encounter_id IS NULL;

            INSERT INTO encounter_provider (encounter_id, provider_id, encounter_role_id, creator, date_created, voided,
                                            uuid)
            SELECT encounter_id, 1, 1, 1, date_created, voided, uuid() AS uuid
            FROM encounter
            WHERE encounter_type = 19
              AND encounter_id NOT IN (SELECT encounter_id FROM encounter_provider)
              AND voided = 0;
        </sql>
    </changeSet>

    <changeSet id="supply-update-encounter-type-dispensation-uuid" author="BOGUI SERGE">
        <preConditions>
            <sqlCheck expectedResult="1">
                <![CDATA[
                SELECT COUNT(*)
                FROM encounter_type
                WHERE name = 'DISPENSATION'
                  AND uuid <> 'DISPENSATIONEEEEEEEEEEEEEEEEEEEEEEEE'
                ]]>
            </sqlCheck>
        </preConditions>
        <sql>
            UPDATE encounter_type
            SET uuid = 'DISPENSATIONEEEEEEEEEEEEEEEEEEEEEEEE'
            WHERE name = 'DISPENSATION';
        </sql>
    </changeSet>

    <changeSet id="supply2-insert-product-unit-to-supply2" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <and>
                <sqlCheck expectedResult="0">SELECT COUNT(*)
                    FROM supply2_product_unit;
                </sqlCheck>
                <tableExists tableName="supply_product_unit"/>
            </and>
        </preConditions>
        <sql>
            INSERT INTO supply2_product_unit (name, description, uuid)
            SELECT name, description, uuid
            FROM supply_product_unit;
        </sql>
    </changeSet>

    <changeSet id="supply2-insert-product-program-to-supply2" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <and>
                <sqlCheck expectedResult="0">SELECT COUNT(*)
                    FROM supply2_product_program;
                </sqlCheck>

                <tableExists tableName="supply_product_program"/>
            </and>
        </preConditions>
        <sql>
            INSERT INTO supply2_product_program (name, description, uuid)
            SELECT name, description, uuid
            FROM supply_product_program;
        </sql>
    </changeSet>

    <changeSet id="supply2-insert-product-supply-to-supply2" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <and>
                <sqlCheck expectedResult="0">SELECT COUNT(*)
                    FROM supply2_product;
                </sqlCheck>
                <tableExists tableName="supply_product"/>
            </and>
        </preConditions>
        <sql>
            INSERT INTO supply2_product (product_id, conversion_unit, creator, date_created, changed_by, date_changed,
                                         voided, uuid)
            SELECT product_id,
                   conversion_unit,
                   creator,
                   date_created,
                   changed_by,
                   date_changed,
                   voided,
                   uuid
            FROM supply_product;

            INSERT INTO supply2_product_name (product_name_id, product_id, product_name_type, name, product_unit, uuid)
            SELECT product_name_id, product_id, product_name_type, name, product_unit, uuid
            FROM supply_product_name;
        </sql>
    </changeSet>

    <changeSet id="supply2-insert-product-code-supply-to-supply2" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <and>
                <sqlCheck expectedResult="0">
                    SELECT COUNT(*)
                    FROM supply2_product_code;
                </sqlCheck>

                <tableExists tableName="supply_product"/>
            </and>
        </preConditions>
        <sql>
            <![CDATA[
            INSERT INTO supply2_product_code (product_id, program_id, code, creator, date_created, changed_by,
                                              date_changed, voided, uuid)
            SELECT sp.product_id,
                   program_id,
                   CONCAT_WS('-', code, program_id)        AS code,
                   creator,
                   date_created,
                   changed_by,
                   date_changed,
                   voided,
                   CONCAT(code, IF(program_id < 10, CONCAT('0', program_id), program_id),
                          'PPPPPPPPPPPPPPPPPPPPPPPPPPPPP') AS uuid
            FROM supply_product sp
                     LEFT JOIN supply_product_program_members sppm ON sp.product_id = sppm.product_id
                     LEFT JOIN (SELECT name, product_id
                                FROM supply_product_name
                                WHERE product_name_type = 'DISPENSATION') spn on sp.product_id = spn.product_id
            ]]>
        </sql>
    </changeSet>

    <changeSet id="supply2-insert-product-price-to-supply2" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <and>
                <sqlCheck expectedResult="0">
                    SELECT COUNT(*)
                    FROM supply2_product_price;
                </sqlCheck>
                <tableExists tableName="supply_product_price"/>
            </and>
        </preConditions>
        <sql>
            <![CDATA[
            INSERT INTO supply2_product_price
            (product_price_id, product_code_id, purchase_price, sale_price, is_active,
             location_id, creator, date_created, changed_by, date_changed, voided, uuid)
            SELECT product_price_id,
                   product_code_id,
                   purchase_price,
                   sale_price,
                   is_active,
                   location_id,
                   spp.creator,
                   spp.date_created,
                   spp.changed_by,
                   spp.date_changed,
                   spp.voided,
                   spp.uuid
            FROM supply_product_price spp,
                 supply2_product_code spp2
            WHERE spp2.program_id = spp.product_program_id
              AND spp2.product_id = spp.product_id
            ]]>
        </sql>
    </changeSet>

    <changeSet id="supply2-insert-supply-product-operation-to-supply2" author="BOGUI SERGE">
        <!--       supply2-insert-supply-product-operation-to-supply2-->
        <preConditions onFail="MARK_RAN">
            <and>
                <sqlCheck expectedResult="0">
                    SELECT COUNT(*)
                    FROM supply2_product_operation;
                </sqlCheck>

                <tableExists tableName="supply_product_operation"/>
            </and>
        </preConditions>
        <sql>
            <![CDATA[
            INSERT INTO supply2_product_operation
            SELECT product_operation_id,
                   operation_number,
                   program_id,
                   spot2.product_operation_type_id,
                   operation_date,
                   operation_status,
                   incidence,
                   linked_operation,
                   quantity_type,
                   observation,
                   exchange_location,
                   location_id,
                   creator,
                   date_created,
                   changed_by,
                   date_changed,
                   voided,
                   voided_by,
                   date_voided,
                   void_reason,
                   spo.uuid
            FROM supply_product_operation spo,
                 supply_product_operation_type spot,
                 supply2_product_operation_type spot2
            WHERE spo.operation_type = spot.product_operation_type_id
              AND spot.uuid = spot2.uuid;

            INSERT INTO supply2_product_operation_attribute
            SELECT product_operation_attribute_id,
                   spoat2.product_operation_attribute_type_id,
                   product_operation,
                   value,
                   location_id,
                   creator,
                   date_created,
                   changed_by,
                   date_changed,
                   voided,
                   voided_by,
                   date_voided,
                   void_reason,
                   spoa.uuid
            FROM supply_product_operation_attribute spoa,
                 supply_product_operation_attribute_type spoat,
                 supply2_product_operation_attribute_type spoat2
            WHERE spoa.operation_attribute_type = spoat.product_operation_attribute_type_id
              AND spoat.uuid = spoat2.uuid;
            ]]>
        </sql>
    </changeSet>

    <changeSet id="supply2-insert-supply-product-operation-flux-to-supply2" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <and>
                <sqlCheck expectedResult="0">
                    SELECT COUNT(*)
                    FROM supply2_product_operation_flux;
                </sqlCheck>

                <tableExists tableName="supply_product_operation_flux"/>
            </and>
        </preConditions>
        <sql>
            <![CDATA[
            INSERT INTO supply2_product_operation_flux
            (product_operation_flux_id, product_code_id, operation_id, quantity, related_quantity,
             related_quantity_label, observation, location_id, uuid)
            SELECT product_operation_flux_id,
                   product_code_id,
                   operation_id,
                   quantity,
                   related_quantity,
                   related_quantity_label,
                   spof.observation,
                   spo.location_id,
                   spof.uuid
            FROM supply_product_operation_flux spof,
                 supply_product_operation spo,
                 supply2_product_code spc
            WHERE spof.operation_id = spo.product_operation_id
              AND spo.program_id = spc.program_id
              AND spof.product_id = spc.product_id;

            INSERT INTO supply2_product_attribute
            SELECT DISTINCT spa.product_attribute_id,
                            product_code_id,
                            batch_number,
                            spa.location_id,
                            expiry_date,
                            spa.creator,
                            spa.date_created,
                            spa.changed_by,
                            spa.date_changed,
                            spa.voided,
                            spa.voided_by,
                            spa.date_voided,
                            spa.void_reason,
                            spa.uuid
            FROM supply_product_attribute spa
                     INNER JOIN supply_product_operation_flux_attribute spofa
                                ON spa.product_attribute_id = spofa.product_attribute_id
                     INNER JOIN supply_product_operation_flux spof
                                ON spofa.operation_flux_id = spof.product_operation_flux_id
                     INNER JOIN supply_product_operation spo ON spof.operation_id = spo.product_operation_id
                     INNER JOIN supply2_product_code spc
                                ON spc.program_id = spo.program_id AND spc.product_id = spof.product_id;

            INSERT INTO supply2_product_operation_flux_attribute
            SELECT *
            FROM supply_product_operation_flux_attribute;

            INSERT INTO supply2_product_attribute_stock
            (product_attribute_stock_id,
             product_attribute,
             operation_id,
             quantity_in_stock,
             location_id,
             creator,
             date_created,
             changed_by,
             date_changed,
             voided,
             voided_by,
             date_voided,
             void_reason,
             uuid)
            SELECT product_attribute_stock_id,
                   product_attribute,
                   operation_id,
                   quantity_in_stock,
                   location_id,
                   creator,
                   date_created,
                   changed_by,
                   date_changed,
                   voided,
                   voided_by,
                   date_voided,
                   void_reason,
                   uuid
            FROM supply_product_attribute_stock;
            ]]>
        </sql>
    </changeSet>

    <changeSet id="supply2-update-operation-attribute-uuid-to-38-length" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">
                SELECT COUNT(*)
                FROM supply2_product_operation_attribute_type
                WHERE uuid = 'INVENTORYSTARTDATEAAAAAAAAAAAAAAAAAA';
            </sqlCheck>
        </preConditions>
        <sql>
            UPDATE supply2_product_operation_attribute_type
            SET uuid = 'INVENTORYSTARTDATEAAAAAAAAAAAAAAAAAAAA'
            WHERE uuid = 'INVENTORYSTARTDATEAAAAAAAAAAAAAAAAAA';
        </sql>
    </changeSet>

    <changeSet id="supply2-insert-product-regime-members-to-product" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <and>
                <sqlCheck expectedResult="0">
                    SELECT COUNT(*)
                    FROM supply2_product_code_regime_members;
                </sqlCheck>

                <tableExists tableName="supply_product"/>
            </and>
        </preConditions>
        <sql>
            INSERT INTO supply2_product_code_regime_members (regime_id, product_code_id)
            SELECT s2pr.product_regime_id,
                   product_code_id
            FROM supply_product sp
                     INNER JOIN supply_product_regime_members sprm ON sp.product_id = sprm.product_id
                     INNER JOIN supply_product_regime spr ON sprm.regime_id = spr.product_regime_id
                     INNER JOIN supply2_product s2p ON s2p.product_id = sp.product_id
                     INNER JOIN (SELECT product_code_id, product_id
                                 FROM supply2_product_code
                                 WHERE program_id =
                                       (SELECT product_program_id
                                        FROM supply2_product_program pp
                                        WHERE name LIKE 'PNLS%IO')) s2pc
                                ON s2p.product_id = s2pc.product_id
                     INNER JOIN supply2_product_regime s2pr on spr.concept_id = s2pr.concept_id;
        </sql>
    </changeSet>

    <changeSet id="supply2-add-operation-attribute-type-lead-time" author="BOGUI SERGE" dbms="mariadb,mysql">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM supply2_product_operation_attribute_type
                WHERE uuid = 'LEADTIMEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'
            </sqlCheck>
        </preConditions>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">3</column>
            <column name="name">Dlai d'approvisionnement</column>
            <column name="description">Dlai d'approvisionnement du rapport</column>
            <column name="format">java.lang.Double</column>
            <column name="sort_weight">1</column>
            <column name="searchable">1</column>
            <column name="uuid">LEADTIMEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
    </changeSet>

    <changeSet id="supply2-product-notification-create" author="BOGUI SERGE">
        <preConditions onError="WARN" onFail="MARK_RAN">
            <not>
                <tableExists tableName="supply2_product_notification"/>
            </not>
        </preConditions>
        <createTable tableName="supply2_product_notification">
            <column name="product_notification_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="product_code_id" type="int"/>
            <column name="operation_type_id" type="int"/>
            <column name="notification_date" type="date">
                <constraints nullable="false"/>
            </column>
            <column name="notification" type="varchar(200)">
                <constraints nullable="false"/>
            </column>
            <column name="notification_info" type="varchar(255)" defaultValue="null"/>
            <column name="location_id" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="notified_to" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="notification_read" type="boolean" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="notification_closed" type="boolean" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>

            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
        <addForeignKeyConstraint baseTableName="supply2_product_notification" baseColumnNames="product_code_id"
                                 referencedTableName="supply2_product_code"
                                 referencedColumnNames="product_code_id"
                                 constraintName="supply2_product_notification_product_coded"/>

        <addForeignKeyConstraint baseTableName="supply2_product_notification" baseColumnNames="operation_type_id"
                                 referencedTableName="supply2_product_operation_type"
                                 referencedColumnNames="product_operation_type_id"
                                 constraintName="supply2_product_notification_operation_type"/>

        <addForeignKeyConstraint baseTableName="supply2_product_notification" baseColumnNames="location_id"
                                 referencedTableName="location" referencedColumnNames="location_id"
                                 constraintName="supply2_product_notification_location"/>

        <addForeignKeyConstraint baseTableName="supply2_product_notification" baseColumnNames="notified_to"
                                 referencedTableName="location" referencedColumnNames="location_id"
                                 constraintName="supply2_product_notification_notified_to"/>
    </changeSet>

    <changeSet id="supply2-add-operation-attribute-type-submit-date" author="BOGUI SERGE" dbms="mariadb,mysql">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM supply2_product_operation_attribute_type
                WHERE uuid = 'SUBMITDATEAAAAAAAAAAAAAAAAAAAAAAAAAAAA'
            </sqlCheck>
        </preConditions>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">4</column>
            <column name="name">Date de soumission du rapport</column>
            <column name="description">Date de soumission du rapport</column>
            <column name="format">java.util.Date</column>
            <column name="sort_weight">1</column>
            <column name="searchable">1</column>
            <column name="uuid">SUBMITDATEAAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
    </changeSet>

    <changeSet id="supply2-add-operation-attribute-type-dispensation" author="BOGUI SERGE" dbms="mariadb,mysql">
        <preConditions onFail="MARK_RAN" onError="WARN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM supply2_product_operation_attribute_type
                WHERE uuid = 'PROVIDERAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'
            </sqlCheck>
        </preConditions>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">5</column>
            <column name="name">Prescripteur</column>
            <column name="description">Prescripteur au cours de la dispensation</column>
            <column name="format">org.openmrs.Provider</column>
            <column name="sort_weight">1</column>
            <column name="searchable">1</column>
            <column name="uuid">PROVIDERAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">6</column>
            <column name="name">Date de prescription</column>
            <column name="description">Date de la prescription au cours de la dispensation</column>
            <column name="format">java.util.Date</column>
            <column name="sort_weight">1</column>
            <column name="searchable">1</column>
            <column name="uuid">PRESCIPTIONDATEAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">8</column>
            <column name="name">Ligne thrapeutique</column>
            <column name="description">Ligne thrapeutique au cours de la dispensation</column>
            <column name="format">java.lang.String</column>
            <column name="sort_weight">1</column>
            <column name="searchable">1</column>
            <column name="uuid">RIGIMELINEAAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">9</column>
            <column name="name">Age du patient</column>
            <column name="description">Age du patient pendant la dispensation</column>
            <column name="format">java.lang.Integer</column>
            <column name="sort_weight">1</column>
            <column name="searchable">1</column>
            <column name="uuid">PATIENTAGEAAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">10</column>
            <column name="name">Genre du patient</column>
            <column name="description">Genre du patient pendant la dispensation</column>
            <column name="format">java.lang.String</column>
            <column name="sort_weight">1</column>
            <column name="searchable">1</column>
            <column name="uuid">PATIENTGENDERAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">11</column>
            <column name="name">But de la dispensation</column>
            <column name="description">But pendant la dispensation</column>
            <column name="format">java.lang.String</column>
            <column name="sort_weight">1</column>
            <column name="searchable">1</column>
            <column name="uuid">GOALAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">12</column>
            <column name="name">Date de fin de traitement</column>
            <column name="description">Date de fin de traitement obtenue au cours de la dispensation</column>
            <column name="format">java.util.Date</column>
            <column name="sort_weight">1</column>
            <column name="searchable">1</column>
            <column name="uuid">TREATMENTENDDATEAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">13</column>
            <column name="name">Dispensation du patient du site</column>
            <column name="description">Dispensation au cours de la dispensation</column>
            <column name="format">org.openmrs.Encounter</column>
            <column name="sort_weight">1</column>
            <column name="searchable">1</column>
            <column name="uuid">PATIENTENCOUNTERAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">14</column>
            <column name="name">Dur du traitement</column>
            <column name="description">Dure du traitement au cours de la dispensation</column>
            <column name="format">org.openmrs.Encounter</column>
            <column name="sort_weight">1</column>
            <column name="searchable">1</column>
            <column name="uuid">TREATMENTDURATIONAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
    </changeSet>
    <changeSet id="supply2-add-operation-attribute-type-dispensation-regime" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM supply2_product_operation_attribute_type
                WHERE uuid = 'REGIMEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'
            </sqlCheck>
        </preConditions>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">15</column>
            <column name="name">Regime</column>
            <column name="description">Regime prescrit au cours de la dispensation</column>
            <column name="format">org.openmrs.module.supply.ProductRegime</column>
            <column name="sort_weight">1</column>
            <column name="searchable">1</column>
            <column name="uuid">REGIMEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
    </changeSet>
    <changeSet id="supply2-add-operation-attribute-type-lost-days" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM supply2_product_operation_attribute_type
                WHERE uuid = 'TREATMENTDAYSLOSTAAAAAAAAAAAAAAAAAAAAA'
            </sqlCheck>
        </preConditions>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">16</column>
            <column name="name">Nombre de jour de comprims perdus</column>
            <column name="description">Nombre de jour de comprims perdus au cours de la dispensation</column>
            <column name="format">java.lang.Integer</column>
            <column name="sort_weight">1</column>
            <column name="searchable">1</column>
            <column name="uuid">TREATMENTDAYSLOSTAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
    </changeSet>
    <changeSet id="supply2-update-operation-attribute-treatment-duration" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="org.openmrs.Encounter">
                SELECT format
                FROM supply2_product_operation_attribute_type
                WHERE uuid = 'TREATMENTDURATIONAAAAAAAAAAAAAAAAAAAAA'
            </sqlCheck>
        </preConditions>
        <sql>
            UPDATE supply2_product_operation_attribute_type
            SET format = 'java.lang.Integer'
            WHERE uuid = 'TREATMENTDURATIONAAAAAAAAAAAAAAAAAAAAA'
        </sql>
    </changeSet>
    <changeSet id="supply2-add-operation-attribute-type-encounter" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM supply2_product_operation_attribute_type
                WHERE uuid = 'ENCOUNTERAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'
            </sqlCheck>
        </preConditions>
        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">17</column>
            <column name="name">Encounter dispensation</column>
            <column name="description">Encounter dispensation for local patient</column>
            <column name="format">org.openmrs.Encounter</column>
            <column name="sort_weight">1</column>
            <column name="searchable">1</column>
            <column name="uuid">ENCOUNTERAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>
    </changeSet>
    <changeSet id="supply2-add-operation-attribute-type-partner" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM supply2_product_operation_attribute_type
                WHERE uuid = 'PARTNERAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'
            </sqlCheck>
        </preConditions>

        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">18</column>
            <column name="name">Partenaire</column>
            <column name="description">Partenaire destinataire pour les sorties et les entres de stocks</column>
            <column name="format">java.lang.String</column>
            <column name="sort_weight">1</column>
            <column name="searchable">1</column>
            <column name="uuid">PARTNERAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>

    </changeSet>
    <changeSet id="supply2-add-operation-attribute-treatment-date" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM supply2_product_operation_attribute_type
                WHERE uuid = 'TREATMENTDATEAAAAAAAAAAAAAAAAAAAAAAAAA'
            </sqlCheck>
        </preConditions>

        <insert tableName="supply2_product_operation_attribute_type">
            <column name="product_operation_attribute_type_id">19</column>
            <column name="name">Date de traitement du rapport</column>
            <column name="description">La date de traitement du rapport soumis par le PPS ou le site</column>
            <column name="format">java.util.Date</column>
            <column name="sort_weight">1</column>
            <column name="searchable">1</column>
            <column name="uuid">TREATMENTDATEAAAAAAAAAAAAAAAAAAAAAAAAA</column>
        </insert>

    </changeSet>

    <changeSet id="supply2-update-program-PNLSARVIO" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">
                SELECT COUNT(*)
                FROM supply2_product_program
                WHERE name = 'PNLSARVIO'
            </sqlCheck>
        </preConditions>
        <sql>
            UPDATE supply2_product_program
            SET name = 'PNLS-ANTIRETROVIRAUX ET IO',
                uuid = 'PNLSANTIRETROVIRAUXETIOPPPPPPPPPPPPPPP'
            WHERE name = 'PNLSARVIO';
        </sql>
    </changeSet>

    <changeSet id="supply2-update-program-PNLSCV" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">
                SELECT COUNT(*)
                FROM supply2_product_program
                WHERE name = 'PNLS_CHARGE VIRALE'
            </sqlCheck>
        </preConditions>
        <sql>
            UPDATE supply2_product_program
            SET name = 'PNLS-CHARGES VIRALES',
                uuid = 'PNLSCHARGESVIRALESPPPPPPPPPPPPPPPPPPPP'
            WHERE name = 'PNLS_CHARGE VIRALE';
        </sql>
    </changeSet>

    <changeSet id="supply2-update-program-PNLSLAB" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">
                SELECT COUNT(*)
                FROM supply2_product_program
                WHERE name = 'PNLSLAB'
            </sqlCheck>
        </preConditions>
        <sql>
            UPDATE supply2_product_program
            SET name = 'PNLS-PRODUITS DE LABORATOIRE',
                uuid = 'PNLSPRODUITSDELABORATOIREPPPPPPPPPPPPP'
            WHERE name = 'PNLSLAB';
        </sql>
    </changeSet>

    <changeSet id="supply2-update-program-PNLSTRC" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">
                SELECT COUNT(*)
                FROM supply2_product_program
                WHERE name = 'PNLSTRC'
            </sqlCheck>
        </preConditions>
        <sql>
            UPDATE supply2_product_program
            SET name = 'PNLS-TESTS RAPIDES ET CONSOMMABLES',
                uuid = 'PNLSTESTSRAPIDESETCONSOMMABLESPPPPPPPP'
            WHERE name = 'PNLSTRC';
        </sql>
    </changeSet>

    <changeSet id="supply2-update-location-program-PNLSARVIO" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="0">
                    SELECT COUNT(*) FROM location_attribute WHERE value_reference LIKE '%PNLSARVIO%';
                </sqlCheck>
            </not>
        </preConditions>
        <sql>
            UPDATE location_attribute
            SET value_reference =
                    REPLACE(value_reference, 'PNLSARVIO', 'PNLS-ANTIRETROVIRAUX ET IO')
            WHERE attribute_type_id = (SELECT location_attribute_type_id
                                       FROM location_attribute_type
                                       WHERE uuid = 'AVAILPRGRMCCCCCCCCCCCCCCCCCCCCCCCCCC');

        </sql>
    </changeSet>

    <changeSet id="supply2-update-location-program-PNLSLAB" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="0">
                    SELECT COUNT(*) FROM location_attribute WHERE value_reference LIKE '%PNLSLAB%';
                </sqlCheck>
            </not>
        </preConditions>
        <sql>
            UPDATE location_attribute
            SET value_reference =
                    REPLACE(value_reference, 'PNLSLAB', 'PNLS-PRODUITS DE LABORATOIRE')
            WHERE attribute_type_id = (SELECT location_attribute_type_id
                                       FROM location_attribute_type
                                       WHERE uuid = 'AVAILPRGRMCCCCCCCCCCCCCCCCCCCCCCCCCC');

        </sql>
    </changeSet>

    <changeSet id="supply2-update-location-program-PNLSTRC" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="0">
                    SELECT COUNT(*) FROM location_attribute WHERE value_reference LIKE '%PNLSTRC%';
                </sqlCheck>
            </not>
        </preConditions>
        <sql>
            UPDATE location_attribute
            SET value_reference =
                    REPLACE(value_reference, 'PNLSTRC', 'PNLS-TESTS RAPIDES ET CONSOMMABLES')
            WHERE attribute_type_id = (SELECT location_attribute_type_id
                                       FROM location_attribute_type
                                       WHERE uuid = 'AVAILPRGRMCCCCCCCCCCCCCCCCCCCCCCCCCC');

        </sql>
    </changeSet>

    <changeSet id="supply2-update-location-program-PNLSCV" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="0">
                    SELECT COUNT(*) FROM location_attribute WHERE value_reference LIKE '%PNLS_CHARGE VIRALE%';
                </sqlCheck>
            </not>
        </preConditions>
        <sql>
            UPDATE location_attribute
            SET value_reference =
                    REPLACE(value_reference, 'PNLS_CHARGE VIRALE', 'PNLS-CHARGES VIRALES')
            WHERE attribute_type_id = (SELECT location_attribute_type_id
                                       FROM location_attribute_type
                                       WHERE uuid = 'AVAILPRGRMCCCCCCCCCCCCCCCCCCCCCCCCCC');

        </sql>
    </changeSet>

    <changeSet id="supply2-product-stock-status" author="BOGUI SERGE">
        <preConditions>
            <not>
                <tableExists tableName="supply2_product_stock_status"/>
            </not>
        </preConditions>
        <createTable tableName="supply2_product_stock_status">
            <column name="product_stock_status_id" type="integer" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="product_code_id" type="integer">
                <constraints nullable="false"/>
            </column>
            <column name="location_id" type="integer">
                <constraints nullable="false"/>
            </column>
            <column name="quantity_in_stock" type="double">
                <constraints nullable="false"/>
            </column>
            <column name="average_consumed_quantity" type="double">
                <constraints nullable="false"/>
            </column>
            <column name="stock_date" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="uuid" type="varchar(38)">
                <constraints nullable="false" unique="true"/>
            </column>
        </createTable>
        <addForeignKeyConstraint constraintName="supply2_product_stock_status_location"
                                 baseTableName="supply2_product_stock_status" baseColumnNames="location_id"
                                 referencedTableName="location"
                                 referencedColumnNames="location_id"/>
        <addForeignKeyConstraint constraintName="supply2_product_stock_status_product_code"
                                 baseTableName="supply2_product_stock_status" baseColumnNames="product_code_id"
                                 referencedTableName="supply2_product_code"
                                 referencedColumnNames="product_code_id"/>

    </changeSet>

    <changeSet id="supply2-add-column-expiry-next-date-stock-status" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="supply2_product_stock_status" columnName="expiry_next_date"/>
            </not>
        </preConditions>
        <addColumn tableName="supply2_product_stock_status">
            <column name="expiry_next_date" type="date"/>
        </addColumn>
    </changeSet>

    <changeSet id="supply2-add-column-product-stock-status-unique" author="BOGUI SERGE">
        <preConditions onFail="MARK_RAN">
            <not>
                <indexExists tableName="supply2_product_stock_status" columnNames="product_code_id,location_id"
                             indexName="uniqueness_product_code_location_stock_status"/>
            </not>
        </preConditions>
        <addUniqueConstraint tableName="supply2_product_stock_status" columnNames="product_code_id,location_id"
                             constraintName="uniqueness_product_code_location_stock_status"/>
    </changeSet>

    <!--    <changeSet id="supply2-fill-product-stock-status-first-data" author="BOGUI SERGE">-->
    <!--        &lt;!&ndash;            <preConditions onFail="MARK_RAN">&ndash;&gt;-->
    <!--        &lt;!&ndash;                <sqlCheck expectedResult="0">SELECT COUNT(*)&ndash;&gt;-->
    <!--        &lt;!&ndash;                                             FROM supply2_product_stock_status</sqlCheck>&ndash;&gt;-->
    <!--        &lt;!&ndash;            </preConditions>&ndash;&gt;-->
    <!--        <sql>-->
    <!--                <![CDATA[-->
    <!--            INSERT INTO supply2_product_stock_status (product_code_id, location_id, quantity_in_stock,-->
    <!--                                                      average_consumed_quantity, stock_date, uuid, expiry_next_date)-->
    <!--            SELECT S.product_code_id,-->
    <!--                   S.location_id,-->
    <!--                   quantityInStock,-->
    <!--                   IF(quantity, quantity, 0) averageConsumedQuantity,-->
    <!--                   NOW(),-->
    <!--                   uuid(),-->
    <!--                   minExpiryDate-->

    <!--            FROM (SELECT product_code_id,-->
    <!--                         SUM(quantity_in_stock) quantityInStock,-->
    <!--                         s2pas.location_id-->
    <!--                  FROM supply2_product_attribute_stock s2pas,-->
    <!--                       supply2_product_attribute s2pa-->
    <!--                  WHERE s2pas.product_attribute = s2pa.product_attribute_id-->
    <!--                    AND s2pas.voided = 0-->
    <!--                  GROUP BY s2pa.product_code_id, s2pas.location_id) S-->
    <!--                     LEFT JOIN (SELECT location_id, MAX(operation_date) date_operation-->
    <!--                                FROM supply2_product_operation-->
    <!--                                WHERE operation_type IN (16, 17)-->
    <!--                                  AND operation_status = 8-->
    <!--                                GROUP BY location_id) lr-->
    <!--                               ON S.location_id = lr.location_id-->
    <!--                     LEFT JOIN (SELECT quantity, location_id, product_code_id-->
    <!--                                FROM supply2_product_operation_other_flux-->
    <!--                                WHERE label = 'CMM') CMM-->
    <!--                               ON CMM.product_code_id = S.product_code_id AND CMM.location_id = S.location_id-->
    <!--                     LEFT JOIN (SELECT product_code_id,-->
    <!--                                       location_id,-->
    <!--                                       MIN(expiry_date) minExpiryDate-->
    <!--                                FROM supply2_product_attribute a-->
    <!--                                WHERE product_attribute_id IN (SELECT product_attribute-->
    <!--                                                               FROM supply2_product_attribute_stock s-->
    <!--                                                               WHERE s.voided = 0-->
    <!--                                                                 AND a.product_attribute_id = s.product_attribute)-->
    <!--                                GROUP BY product_code_id, location_id) LE-->
    <!--                               ON LE.location_id = S.location_id AND LE.product_code_id = S.product_code_id-->
    <!--            WHERE (S.product_code_id, S.location_id) NOT IN (SELECT product_code_id, location_id-->
    <!--                                                             FROM supply2_product_stock_status ss-->
    <!--                                                             WHERE S.product_code_id = ss.product_code_id-->
    <!--                                                               AND S.location_id = ss.location_id)-->
    <!--            GROUP BY S.product_code_id,-->
    <!--                     S.location_id,-->
    <!--                     quantityInStock,-->
    <!--                     quantity-->
    <!--            UNION-->
    <!--            SELECT CMM.product_code_id,-->
    <!--                   LR.location_id,-->
    <!--                   QD.quantityInStock,-->
    <!--                   CMM.quantity,-->
    <!--                   NOW(),-->
    <!--                   uuid(),-->
    <!--                   NULL AS minExpiryDate-->
    <!--            FROM (SELECT location_id, MAX(operation_date) MaxOperationDate-->
    <!--                  FROM supply2_product_operation-->
    <!--                  WHERE operation_type IN (16, 17)-->
    <!--                    AND operation_status = 8-->
    <!--                  GROUP BY location_id) LR-->
    <!--                     LEFT JOIN (SELECT location_id, operation_date, product_operation_id-->
    <!--                                FROM supply2_product_operation-->
    <!--                                WHERE operation_type IN (16, 17)-->
    <!--                                  AND operation_status = 8) R-->
    <!--                               ON R.location_id = LR.location_id AND R.operation_date = LR.MaxOperationDate-->
    <!--                     LEFT JOIN (SELECT quantity, location_id, product_code_id, operation_id-->
    <!--                                FROM supply2_product_operation_other_flux-->
    <!--                                WHERE label = 'CMM') CMM-->
    <!--                               ON CMM.operation_id = R.product_operation_id-->
    <!--                     LEFT JOIN (SELECT quantity quantityInStock, location_id, product_code_id, operation_id-->
    <!--                                FROM supply2_product_operation_other_flux-->
    <!--                                WHERE label = 'QD') QD-->
    <!--                               ON QD.operation_id = R.product_operation_id AND CMM.product_code_id = QD.product_code_id-->
    <!--            WHERE CMM.product_code_id NOT IN-->
    <!--                  (SELECT product_code_id FROM supply2_product_attribute WHERE QD.product_code_id = product_code_id)-->
    <!--              AND (CMM.product_code_id, CMM.location_id) NOT IN (SELECT product_code_id, location_id-->
    <!--                                                                 FROM supply2_product_stock_status ss-->
    <!--                                                                 WHERE CMM.product_code_id = ss.product_code_id-->
    <!--                                                                   AND CMM.location_id = ss.location_id)-->
    <!--            GROUP BY CMM.product_code_id,-->
    <!--                     LR.location_id,-->
    <!--                     QD.quantityInStock,-->
    <!--                     CMM.quantity;-->
    <!--            ]]>-->
    <!--            </sql>-->
    <!--    </changeSet>-->

</databaseChangeLog>
